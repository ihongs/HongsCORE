H$.inst=function(){var a=$(".HsList,.HsForm").filter(":visible:first");return a.data("HsList")||a.data("HsForm")};H$.src=function(){return(H$.inst()._url||location.pathname).replace(/\?.*/,"").replace(/\/[^\/]+$/,"")};H$.load=function(b){var a=H$.inst();a.load(undefined,hsSerialMix(a._data,b))};H$.send=function(b,c){var a;$.hsAjax({url:hsFixUri(b),data:hsSerialArr(c),complete:function(d){a=hsResponse(d,3)},type:"post",dataType:"json",async:false,cache:false,global:false});return a};H$.search=function(b){var a=H$.src()+"/search.act";return H$.send(a,b)};H$.create=function(b){var a=H$.src()+"/create.act";return H$.send(a,b)};H$.update=function(b){var a=H$.src()+"/update.act";return H$.send(a,b)};H$["delete"]=function(b){var a=H$.src()+"/delete.act";return H$.send(a,b)};function setFormItems(b,a){b.on("loadOver",function(c,e){var d;d=b.find("[data-toggle=dateinput],[data-toggle=datetimepicker]");if(d.size()){forDateInput()}d=b.find("[data-toggle=suggest]");if(d.size()){forSuggInput()}d=b.find("[data-toggle=fileinput]");if(d.size()){setFileInput(d)}d=b.find("[data-toggle=tagsinput]");if(d.size()){setTagsInput(d)}d=b.find("textarea[data-type=html]");if(d.size()){setEditor(d)}d=b.find("textarea[data-type=code]");if(d.size()){setMirror(d)}});b.on("willSave",function(c,d){synEditor(b.find("textarea[data-type]"));if(d){b.find("textarea[data-type]").each(function(){d.set($(this).attr("name"),$(this).val())})}});a.on("hsClose",function(c,d){desEditor(b.find("textarea[data-type]"))})}function setInfoItems(b,a){b.on("loadOver",function(c,e){var d;d=b.find("textarea[data-type=code]");if(d.size()){setMirror(d)}d=b.find("pre[data-type=code]");if(d.size()){setMirror(d)}});a.on("hsClose",function(c,d){desEditor(b.find("textarea[data-type]"))})}function forDateInput(a){hsRequires(["static/addons/bootstrap-datetimepicker/css/datetimepicker.min.css","static/addons/bootstrap-datetimepicker/datetimepicker.min.js"],a)}function forSuggInput(a){hsRequires(["static/addons/bootstrap-suggest/suggest.min.js"],a)}function forFileInput(a){hsRequires(["static/addons/bootstrap-fileinput/css/fileinput.min.css","static/addons/bootstrap-fileinput/fileinput.min.js"],a)}function setFileInput(b,a){forFileInput(function(){b.hsFileInput();a&&a.call(b)})}function forTagsInput(a){hsRequires(["static/addons/bootstrap-tagsinput/css/tagsinput.min.css","static/addons/bootstrap-tagsinput/tagsinput.min.js"],a)}function setTagsInput(b,a){forTagsInput(function(){b.hsTagsInput();a&&a.call(b)})}function synEditor(a){a.each(function(){if($(this).data("synchro")){$(this).data("synchro")()}})}function desEditor(a){a.each(function(){if($(this).data("destroy")){$(this).data("destroy")()}})}function forEditor(a){hsRequires(["static/addons/summernote/summernote.min.css","static/addons/summernote/summernote.min.js"],function(){var b=HsLANG.lang;if(b&&b!="en_US"){b=b.replace("_","-")}else{b=null}if(b){hsRequires(["static/addons/summernote/lang/summernote-"+b+".js"],a)}else{a()}})}function setEditor(b,a){forMirror(function(){forEditor(function(){b.each(function(){var d=this;var e=$(this).hsData()||{};var f=HsLANG.lang.replace("_","-");var c={toolbar:[["font",["color","bold","italic"]],["inst",["table","picture","link"]],["para",["style","paragraph","ul","ol"]],["misc",["clean","codeview"]]],buttons:{clean:function(){return $.summernote.ui.button({contents:'<i class="note-icon-eraser"></i>',tooltip:$.summernote.lang[f].font.clear,click:function(){$.hsMask({title:"富文本格式化工具",html:'<form onsubmit="return false"><div class="form-group row"><label class="col-xs-4 text-right control-label form-control-static">字体</label><div class="col-xs-6"><input class="form-control" type="text"   name="font-family" value="" data-unit="" list="hs-font-list"><datalist id="hs-font-list"><option value="宋体,STSong"  style="font-family: 宋体,STSong" >宋体</option><option value="黑体,STHeiti" style="font-family: 黑体,STHeiti">黑体</option><option value="楷体,STKaiti" style="font-family: 楷体,STKaiti">楷体</option></datalist></div></div><div class="form-group row"><label class="col-xs-4 text-right control-label form-control-static">字号</label><div class="col-xs-4"><input class="form-control" type="number" name="font-size"   value="" data-unit="px" step="1"   min="0" max="36"></div><div class="col-xs-2 form-control-static">(px)</div></div><div class="form-group row"><label class="col-xs-4 text-right control-label form-control-static">行高</label><div class="col-xs-4"><input class="form-control" type="number" name="line-height" value="" data-unit="em" step="0.1" min="0" max="8" ></div><div class="col-xs-2 form-control-static">(em)</div></div><div class="form-group row"><label class="col-xs-4 text-right control-label form-control-static">缩进</label><div class="col-xs-4"><input class="form-control" type="number" name="text-indent" value="" data-unit="em" step="0.5" min="0" max="8" ></div><div class="col-xs-2 form-control-static">(em)</div></div><div class="form-group row"><label class="col-xs-4 text-right control-label form-control-static">段尾间距</label><div class="col-xs-4"><input class="form-control" type="number" name="margin-bottom" value="" data-unit="px" step="1" min="0" max="80"></div><div class="col-xs-2 form-control-static">(px)</div></div><div class="form-group row"><label class="col-xs-4 text-right control-label form-control-static">文本对齐</label><div class="col-xs-4"><select class="form-control" name="text-align" data-unit=""><option value=""></option><option value="center" > 居中对齐</option><option value="justify"> 两端对齐</option></select></div></div><div class="form-group row"><label class="col-xs-4 text-right control-label form-control-static">图片样式</label><div class="col-xs-8 radio checkbox"><label><input type="checkbox" name="pics" data-float="" data-margin="0 auto" data-display="block"> 居中</label><label><input type="checkbox" name="picw" data-width="100%"> 宽 100%</label></div></div><div class="form-group row"><label class="col-xs-4 text-right control-label form-control-static">应用范围</label><div class="col-xs-8 radio"><label><input type="radio" name="area" value="range" checked="checked"> 选段</label><label><input type="radio" name="area" value="whole"> 全部</label><label><input type="radio" name="area" value="clean"> 清理</label></div></div></form>'},{label:"应用",glass:"btn-primary",click:function(){var j=$(this).closest(".modal-content").find("form");var k=j.find("[name=area]:checked").val();var n={width:"",margin:"",display:""};var g={};var r;switch(k){case"range":r=$(d).summernote("getLastRange").nodes();break;case"whole":r=$(d).data("summernote").layoutInfo.editable;r=$(r).find("p,pre,div,ul,ol,h1,h2,h3,h4,h5,h6,table");break;case"clean":var l;l=$(d).summernote("code");if(!/<\w+[^>]+>/.test(l)){l=l.replace(/^/g,"<p>");l=l.replace(/$/g,"</p>")}else{l=l.replace(/<!--[\S\s]*?-->/mg,"");l=l.replace(/(<font(\s[^>]*)?>|<\/font>)/mg,"");l=l.replace(/(<span(\s[^>]*)?>|<\/span>)/mg,"");l=l.replace(/\s(style|class|align|color)=\"[\S\s]*?\"/mg,"");l=l.replace(/<o:p><\/o:p>/mg,"<br/>")}$(d).summernote("code",l);r=$(d).data("summernote").layoutInfo.editable;r=$(r).find("p,pre,div,ul,ol,h1,h2,h3,h4,h5,h6,table");break}j.find("[name^=pic]").each(function(){if($(this).prop("checked")){$.extend(n,$(this).data())}});j.find("[data-unit]").each(function(){var i=$(this).val();var m=$(this).data("unit");var p=$(this).attr("name");if(i===""||i==="0"){i=m=""}g[p]=i+m});for(var q=0;q<r.length;q++){var h=$(r[q]).closest("p,pre,div,h1,h2,h3,h4,h5,h6,ul,ol,table,blockquote,.note-editable");if(h.is(".note-editable")){continue}h.css(g);var o=h.find("img");if(o.size()===0){continue}o.css(n);if(g["text-indent"]&&h.is("h1,h2,h3,h4,h5,h6,ul,ol,table")){h.css("text-indent","")}}}},{label:"取消",glass:"btn-default"})}}).render()}},callbacks:{onImageUpload:function(h){var j=new FormData();for(var g=0;g<h.length;g++){j.append("file.",h[g])}$.ajax({url:hsFixUri(ADD_IMG_HREF),data:j,type:"POST",dataType:"json",cache:false,contentType:false,processData:false,success:function(l){l=hsResponse(l);if(!l.ok){return}for(var k=0;k<l.file.length;k++){$(d).summernote("insertImage",l.file[k])}}})}},codemirror:{mode:"text/html",htmlMode:true,lineNumbers:true,lineWrapping:true},styleTags:["p","h6","h5","h4","h3","h2","h1","pre","blockquote"],colorButton:{foreColor:"#FFFFFF",backColor:"#474949"},placeholder:$(this).attr("placeholder")||"",minHeight:$(this).height()*1,maxHeight:$(this).height()*2,lang:f};$(this).summernote($.extend(c,e));$(this).siblings(".note-editor").find(".note-current-color-button").attr("data-backcolor","inherit").find("i").css("background-color","inherit");$(this).data("destroy",function(){$(d).summernote("destroy")})});a&&a.call(b)})},"xml")}function forMirror(a,b){hsRequires(["static/addons/codemirror/codemirror.min.css","static/addons/codemirror/codemirror.min.js"],function(){if(!$.isArray(b)){b=[b]}var d=[];for(var c=0;c<b.length;c++){d.push("static/addons/codemirror/mode/"+b[c]+"/"+b[c]+".js")}if(d.length){hsRequires(d,a)}else{a()}})}function setMirror(c,b){var a=[];c.each(function(){var d=$(this).data("mode")||$(this).data("type");d=getModeByName(d);a.push(d[0])});forMirror(function(){c.each(function(){var f=$(this);var g=$(this).prop("readonly")&&"nocursor";var h=$(this).data("mode")||$(this).data("type");h=getModeByName(h);if(f.is("textarea")){var d=CodeMirror.fromTextArea(f[0],{mode:h[1],lineNumbers:true,readOnly:g});var e=$(d.getWrapperElement());e.addClass("form-control");e.height(f.height());f.addClass("invisible");f.data("CM",d);f.data("destroy",function(){d.toTextArea()});f.data("synchro",function(){d.save()})}else{var d=CodeMirror(f.parent()[0],{mode:h[1],lineNumbers:true,readOnly:"nocursor",value:f.text()});var e=$(d.getWrapperElement());e.addClass("form-control-static");e.height("auto");f.data("CM",d);f.text("");f.hide()}});b&&b.call(c)},a)}function getModeByName(a){if(a){a=a.replace(/.*\./,"");return EXTN_TO_MODE[a]||[a,a]}else{return[a,a]}}var ADD_IMG_HREF=hsChkUri("centra")?"centra/data/upload/image/create.act":"centre/data/upload/image/create.act";var EXTN_TO_MODE={h:["clike","text/x-c"],c:["clike","text/x-c"],cpp:["clike","text/x-c++src"],cs:["clike","text/x-csharp"],mm:["clike","text/x-objectivec"],m:["clike","text/x-objectivec"],java:["clike","text/x-java"],scala:["clike","text/x-scala"],kotlin:["clike","text/x-kotlin"],groovy:["groovy","groovy"],gradle:["groovy","groovy"],json:["javascript","application/json"],js:["javascript","text/javascript"],ts:["javascript","text/typescrpit"],coffee:["coffee","text/coffeescript"],jsx:["jsx","jsx"],vue:["vue","vue"],xml:["xml","xml"],xsd:["xml","xml"],dtd:["dtd","dtd"],html:["htmlmixed","text/html"],htm:["htmlmixed","text/html"],asp:["htmlembedded","text/aspx"],jsp:["htmlembedded","text/jsp"],go:["go","go"],sql:["sql","sql"],lua:["lua","lua"],php:["php","php"],rb:["ruby","ruby"],py:["python","python"],pl:["perl","perl"],pm:["perl","perl"],sh:["shell","shell"],bat:["shell","shell"],cmd:["shell","shell"],ps1:["powershell","powershell"],css:["css","css"],scss:["css","text/x-scss"],less:["css","text/x-less"],sass:["sass","text/x-sass"],md:["markdown","markdown"],proto:["protobuf","protobuf"],ini:["properties","properties"],cnf:["properties","properties"],conf:["properties","properties"],properties:["properties","properties"]};
