/**
 * HongsCORE4js
 * @author Hongs
 * @version 16.07.17
 */
if(typeof(HsAUTH)==="undefined"){HsAUTH={}}if(typeof(HsCONF)==="undefined"){HsCONF={}}if(typeof(HsLANG)==="undefined"){HsLANG={}}function H$(){var e=arguments[0];var d=e.charAt(0);arguments[0]=e.substring(1);switch(d){case".":return hsGetConf.apply(this,arguments);case":":return hsGetLang.apply(this,arguments);case"?":return hsChkUri.apply(this,arguments);case"/":return hsFixUri.apply(this,arguments);case"&":case"@":if(arguments.length===1){arguments[1]=location.href}if(typeof(arguments[1])!=="string"){if(!jQuery.isArray(arguments[1])){var f=jQuery(arguments[1]).closest(".loadbox");arguments[1]=hsSerialArr(f)}if(d==="@"){return hsGetSerias(arguments[1],arguments[0])}else{return hsGetSeria(arguments[1],arguments[0])}}else{if(d==="@"){return hsGetParams(arguments[1],arguments[0])}else{return hsGetParam(arguments[1],arguments[0])}}case"$":case"%":var g=d==="$"?window.sessionStorage:window.localStorage;if(typeof(g)==="undefined"){throw"H$: Does not support '"+(d=="$"?"session":"local")+"Storage'"}if(arguments.length===1){return g.getItem(arguments[0])}else{if(arguments[1]){g.setItem(arguments[0],arguments[1])}else{g.removeItem(arguments[0])}}default:throw"H$: Unrecognized identified '"+d+"'"}}function hsResponObj(rst,qut,qxt){if(typeof(rst.responseText)!=="undefined"){rst=rst.responseText}if(typeof(rst)==="string"){if(rst.charAt(0)==="{"){if(typeof(JSON)!=="undefined"){rst=JSON.parse(rst)}else{rst=eval("("+rst+")")}}else{if(rst.charAt(0)==="<"){rst={msg:rst.replace(/<script.*?>.*?<\/script>/img,"").replace(/<style.*?>.*?<\/style>/img,"").replace(/<[^>]*?>/g,"").replace(/&[^&;]*;/g,"").replace(/^\s*(\r\n|\r|\n)/mg,""),err:"",ern:"",ok:false}}else{rst={msg:rst,err:"",ern:"",ok:false}}}}if(typeof(rst)==="object"){if(typeof(rst.ok)==="undefined"){rst.ok=true}else{if(rst.ok==="0"){rst.ok=false}}if(typeof(rst.ern)==="undefined"){rst.ern=""}if(typeof(rst.err)==="undefined"){rst.err=""}if(typeof(rst.msg)==="undefined"){rst.msg=""}if(!qxt){if(rst.ern&&/^Er(301|302|401|402|403|404)$/.test(rst.ern)){if(rst.msg){alert(rst.msg)}if(rst.err&&/^Goto /i.test(rst.err)){var url=rst.err.substring(5);if(url&&url!="#"){location.assign(hsFixUri(url))}else{location.reload()}}else{var url=hsGetConf(rst.ern+".redirect");if(url){location.assign(hsFixUri(url))}}throw new Error(rst.err)}}if(!qut){if(rst.ok){if(rst.msg){jQuery.hsNote(rst.msg,"succ")}}else{if(rst.msg){jQuery.hsWarn(rst.msg,"warn")}else{jQuery.hsWarn(hsGetLang("error.unkwn"),"warn")}}}if(typeof(rst.data)!=="undefined"){jQuery.extend(rst,rst.data);delete rst.data}}return rst}function hsSerialArr(f){var h=[];var d=!jQuery.isPlainObject(f)?jQuery.type(f):"objact";switch(d){case"string":var e,c,k,b,g=0;e=f.split("#",2);if(e.length>1){f=e[0]}e=f.split("?",2);if(e.length>1){f=e[1]}e=f.split("&");for(;g<e.length;g++){c=e[g].split("=",2);if(c.length>1){k=decodeURIComponent(c[0]);b=decodeURIComponent(c[1]);h.push({name:k,value:b})}}break;case"objact":hsForEach(f,function(m,i){if(i.length>0){i=i.join(".");h.push({name:i,value:m})}});break;case"object":f=jQuery(f);if(f.data("href")){h=[];var j;var a=f.data("href");var l=f.data("data");j=a.indexOf("?");if(j!=-1){hsSerialMix(h,hsSerialArr(a.substring(j+1)))}j=a.indexOf("#");if(j!=-1){hsSerialMix(h,hsSerialArr(a.substring(j+1)))}if(l){hsSerialMix(h,hsSerialArr(l))}}else{h=jQuery(f).serializeArray()}break;case"array":h=f;break}return h}function hsSerialDic(f){var a=hsSerialArr(f);var e=/(\.\.|\.$)/;f={};for(var d=0;d<a.length;d++){var c=a[d].name;var b=a[d].value;if(c.length==0){continue}c=c.replace(/\]\[/g,".").replace(/\[/,".").replace(/\]/,"");if(e.test(c)){if(f[c]===undefined){f[c]=[]}f[c].push(b)}else{f[c]=b}}return f}function hsSerialObj(c){var a=hsSerialArr(c);c={};for(var b=0;b<a.length;b++){hsSetValue(c,a[b].name,a[b].value)}return c}function hsSerialMix(a,e){var d={};for(var c=0,b=e.length;c<b;c++){d[e[c].name]=1}for(var c=-1,b=a.length-1;c<b;b--){if(d[a[b].name]){a.splice(b,1)}}return jQuery.merge(a,e)}function hsGetSerias(a,b){var d=[];for(var c=0;c<a.length;c++){if(a[c]["name"]===b){d.push(a[c]["value"])}}return d}function hsSetSerias(a,c,e){for(var b=a.length-1;b>-1;b--){if(a[b]["name"]===c){a.splice(b,1)}}for(var d=0;d<e.length;d++){a.push({name:c,value:e[d]})}}function hsGetSeria(a,b){var c=hsGetSerias(a,b);if(c.length){return c.pop()}else{return""}}function hsSetSeria(a,b,c){hsSetSerias(a,b,c!=undefined&&c!=null?[c]:[])}function hsGetParams(c,b){b=encodeURIComponent(b).replace(".","\\.");var d=new RegExp("[\\?&]"+b+"=([^&]*)","g");var a=null;var e=[];while(true){a=d.exec(c);if(a===null){break}e.push(decodeURIComponent(a[1]))}return e}function hsSetParams(b,a,e){a=encodeURIComponent(a).replace(".","\\.");var d=new RegExp("[\\?&]"+a+"=([^&]*)","g");b=b.replace(d,"");for(var c=0;c<e.length;c++){b+="&"+a+"="+encodeURIComponent(e[c])}if(b.indexOf("?")<0){b=b.replace("&","?")}return b}function hsGetParam(b,a){var c=hsGetParams(b,a);if(c.length){return c.pop()}else{return""}}function hsSetParam(b,a,c){return hsSetParams(b,a,c!=undefined&&c!=null?[c]:[])}function hsGetValue(d,c,b){if(jQuery.isArray(c)){return _hsGetPoint(d,c,b)}else{if(typeof(c)==="number"){var a=[c];return _hsGetPoint(d,a,b)}else{if(typeof(c)==="string"){var a=_hsGetPkeys(c);return _hsGetPoint(d,a,b)}else{throw"hsGetValue: 'path' must be an array or string"}}}}function _hsGetPoint(c,a,b){if(!c){return b}if(!jQuery.isArray(c)&&!jQuery.isPlainObject(c)){throw"_hsGetPoint: 'obj' must be an array or object"}if(!jQuery.isArray(a)){throw"_hsGetPoint: 'keys' must be an array"}if(!a.length){throw"_hsGetPoint: 'keys' can not be empty"}return _hsGetDepth(c,a,b,0)}function _hsGetDepth(d,b,c,e){var a=b[e];if(d==null){return c}if(a==null){if(b.length==e+1){return d}else{return _hsGetDapth(d,b,c,e+1)}}else{if(typeof(a)=="number"){if(d.length<=a){return c}if(b.length==e+1){return d[a]||c}else{return _hsGetDepth(d[a],b,c,e+1)}}else{if(b.length==e+1){return d[a]||c}else{return _hsGetDepth(d[a],b,c,e+1)}}}}function _hsGetDapth(a,d,e,g){var b=[];for(var c=0;c<a.length;c++){var f=_hsGetDepth(a[c],d,e,g);if(f!=null){b.push(f)}}if(!jQuery.isEmptyObject(b)){return b}else{return e}}function _hsGetPkeys(d){d=d.replace(/\]\[/g,".").replace(/\[/,".").replace(/\]/,"").split(/\./);var b,c=[];for(b=0;b<d.length;b++){var a=d[b];if(a.length==0&&b!=0){c.push(null)}else{c.push(a)}}return c}function hsSetValue(c,b,d){if(jQuery.isArray(b)){_hsSetPoint(c,b,d)}else{if(typeof(b)==="number"){var a=[b];_hsSetPoint(c,a,d)}else{if(typeof(b)==="string"){var a=_hsGetPkeys(b);_hsSetPoint(c,a,d)}else{throw"hsSetValue: 'path' must be an array or string"}}}}function _hsSetPoint(b,a,c){if(!b){return}if(!jQuery.isPlainObject(b)){throw"_hsSetPoint: 'obj' must be an object"}if(!jQuery.isArray(a)){throw"_hsSetPoint: 'keys' must be an array"}if(!a.length){throw"_hsSetPoint: 'keys' can not be empty"}_hsSetDepth(b,a,c,0)}function _hsSetDepth(d,c,e,f){var b=c[f];if(b==null){if(d==null){d=[]}if(c.length==f+1){d.push(e)}else{d.push(_hsSetDepth(null,c,e,f+1))}return d}else{if(typeof(b)=="number"){if(d==null){d=[]}if(d.length<=b){for(var a=0;a<=b;a++){d.push(null)}}if(c.length==f+1){d[b]=e}else{d[b]=_hsSetDepth(d[b],c,e,f+1)}return d}else{if(d==null){d={}}if(c.length==f+1){d[b]=e}else{d[b]=_hsSetDepth(d[b],c,e,f+1)}return d}}}function hsForEach(d,c){var e=[];if(arguments.length>2){e=arguments[2]}if(jQuery.isPlainObject(d)){for(var a in d){hsForEach(d[a],c,e.concat([a]))}}else{if(jQuery.isArray(d)){for(var b=0;b<d.length;b++){hsForEach(d[b],c,e.concat([b]))}}else{if(e.length>0){c(d,e)}}}}function hsGetConf(a,b){if(typeof(HsCONF[a])!=="undefined"){return HsCONF[a]}else{return b}}function hsGetLang(c,d){if(typeof(HsLANG[c])!=="undefined"){c=HsLANG[c]}if(d instanceof Array){var b,a={};for(b in d){a[b+""]=d[b]}d=a}if(d instanceof Object){c=c.replace(/\$(\w+|\{.+?\})/gm,function(e){if(e.substring(0,2)=="${"){e=e.substring(2,e.length-1)}else{e=e.substring(1)}if(typeof(d[e])!=="undefined"){return d[e]}else{return""}})}return c}function hsChkUri(a){if(typeof(HsAUTH[a])!=="undefined"){return HsAUTH[a]}else{return true}}function hsFixUri(a){if(/^(\w+:\/\/|\/|\.|\.\.)/.test(a)===false){var b=HsCONF.BASE_HREF;if(b==undefined){b=jQuery("base").attr("href");if(b!=undefined){b=b.replace(/\/$/,"");HsCONF.BASE_HREF=b}}return b+"/"+a}else{return a}}function hsFixPms(b,a){if(a instanceof Element||a instanceof jQuery){a=jQuery(a).closest(".loadbox");a=hsSerialArr(a)}a=hsSerialObj(a);return b.replace(/\$(\w+|\{.+?\})/gm,function(c){if(c.substring(0,2)==="${"){c=c.substring(2,c.length-1)}else{c=c.substring(1)}c=hsGetValue(a,c);return c||""})}function hsFmtNum(r,u,h,y,c){if(typeof(u)==="undefined"){u=0}if(typeof(h)==="undefined"){h=2}if(typeof(y)==="undefined"){y=","}if(typeof(c)==="undefined"){c="."}var f=parseInt(r);if(isNaN(f)){f=0}var e=Math.pow(10,h);r=(Math.round(f*e)/e).toString();var w=r.split(".",2);if(w.length<2){w[1]="0"}var g=w[0];var v=w[1];var b=g.length;for(var q=b;q<u;q++){g="0"+g}var t=v.length;for(var m=t;m<h;m++){v=v+"0"}r="";h="";if(y){var l,x="";while(g!=""){l=g.length-3;x=g.substring(l);g=g.substring(0,l);r=x+y+r}if(r){l=r.length-1;r=r.substring(0,l)}while(v!=""){x=v.substring(0,3);v=v.substring(3);h=h+y+x}if(h){h=h.substring(1)}}else{r=g;h=v}return r+c+h}function hsFmtDate(f,r){if(f===undefined){return""}if(typeof(f)==="string"){if(/^\d+$/.test(f)){f=parseInt(f)}else{f=Date.parse(f.replace(/-/g,"/").replace(/\.\d+$/,""))}}if(typeof(f)==="number"){if(f==0){return""}if(f<=2147483647){f=f*1000}f=new Date(f)}var o=f.getFullYear();var l=f.getMonth();var n=f.getDate();var t=f.getHours();var g=t+1;var p=t>11?t-12:t;var j=t>12?t-12:t;var e=f.getMinutes();var v=f.getSeconds();var i=f.getMilliseconds();var u=f.getDay();var q=t<12?0:1;if(p==12){p=0}if(j==0){j=12}function c(h,a){h=h?h:"";h=h.toString();var d=h.length;for(var k=d;k<a;k++){h="0"+h}return h}function b(k){var d=k.length;var h=k.substring(0,1);switch(h){case"y":var a=c(o,d);if(d<=2){return a.substring(a.length-d)}else{return a}case"M":if(d>=4){return hsGetLang("date.format.LM")[l]}else{if(d==3){return hsGetLang("date.format.SM")[l]}else{return c(l+1,d)}}case"d":return c(n,d);case"H":return c(t,d);case"k":return c(g,d);case"K":return c(p,d);case"h":return c(j,d);case"m":return c(e,d);case"s":return c(v,d);case"S":return c(i,d);case"E":if(d>=4){return hsGetLang("date.format.LE")[u]}else{return hsGetLang("date.format.SE")[u]}case"a":if(d>=4){return hsGetLang("date.format.La")[q]}else{return hsGetLang("date.format.Sa")[q]}}}return r.replace(/M+|d+|y+|H+|k+|K+|h+|m+|s+|S+|E+|a+/g,b)}function hsPrsDate(w,t){if(w===undefined){return new Date(0)}if(typeof(w)==="string"){if(/^\d+$/.test(w)){w=parseInt(w)}}if(typeof(w)==="number"){if(w<=2147483647){w=w*1000}return new Date(w)}var r=w.split(/\W+/);var q=t.match(/M+|d+|y+|H+|k+|K+|h+|m+|s+|S+|E+|a+/g);var k,h;var n,o,p,v=0,g=0,x=0,f=0;for(k=0;k<q.length;k++){if(r[k]==null){continue}var u=r[k];var l=q[k].length;var e=q[k].substring(0,1);switch(e){case"M":if(l>=4){for(h=0;h<hsGetLang("date.format.LM").length;h++){if(u==hsGetLang("date.format.LM")[h]){n=h;break}}}else{if(l==3){for(h=0;h<hsGetLang("date.format.SM").length;h++){if(u==hsGetLang("date.format.SM")[h]){n=h;break}}}else{n=parseInt(u,10)}}break;case"d":o=parseInt(u,10);break;case"y":p=parseInt(u,10);if(l<=2){p+=p>29?1900:2000}break;case"H":case"K":v=parseInt(u,10);break;case"k":case"h":v=parseInt(u,10)-1;break;case"m":g=parseInt(u,10);break;case"s":x=parseInt(u,10);break;case"a":if(l>=4){for(h=0;h<hsGetLang("date.format.La").length;h++){if(u==hsGetLang("date.format.La")[h]){f=h;break}}}else{for(h=0;h<hsGetLang("date.format.Sa").length;h++){if(u==hsGetLang("date.format.Sa")[h]){f=h;break}}}break}}if(f==1){v+=12}var c;if(typeof(n)!=="undefined"&&typeof(o)!=="undefined"&&typeof(p)!=="undefined"){c=n+"/"+o+"/"+p+" "+v+":"+g+":"+x}else{c=v+":"+g+":"+x}return new Date(Date.parse(c))}function _hs2bsDF(a){return a.replace(/a/g,"P").replace(/m/g,"i").replace(/M/g,"m").replace(/H/g,"x").replace(/h/g,"H").replace(/x/g,"h")}function _bs2hsDF(a){return a.replace(/m/g,"M").replace(/i/g,"m").replace(/P/gi,"a").replace(/H/g,"x").replace(/h/g,"H").replace(/x/g,"h")}(function($){$.jqAjax=$.ajax;$.hsAjax=function(url,settings){if(typeof(url)==="object"){settings=url;if(typeof(url.url)!=="undefined"){url=url.url}}if(settings.dataKind){switch(settings.dataKind.toLowerCase()){case"form":if($.isArray(settings.data)||$.isPlainObject(settings.data)||settings.data instanceof jQuery||settings.data instanceof Element){var hsStringprm=jQuery.param;settings.data=hsSerialArr(settings.data);settings.data=hsStringprm(settings.data)}settings.contentType="application/x-www-form-urlencoded; charset=UTF-8";break;case"json":if($.isArray(settings.data)||$.isPlainObject(settings.data)||settings.data instanceof jQuery||settings.data instanceof Element){var hsStringify=JSON.stringify;settings.data=hsSerialObj(settings.data);settings.data=hsStringify(settings.data)}settings.contentType="application/json; charset=UTF-8";break;case"xml":if(settings.data instanceof jQuery||settings.data instanceof Element){settings.data='<?xml version="1.0"?>'+$(settings.data).prop("outerHTML")}settings.contentType="application/xml ; charset=UTF-8";break;default:throw new Error("hsAjax: Unrecognized dataKind "+settings.dataKind)}}return $.jqAjax(hsFixUri(url),settings)};$.hsOpen=function(url,data,complete){var div=$('<div class="modal fade in"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4  class="modal-title"  >'+hsGetLang("opening")+'</h4></div><div class="modal-body openbox"></div></div></div></div>');var box=div.find(".openbox");box.hsLoad(url,data,complete);div.on("hide.bs.modal",function(){div.remove()});div.modal();return box};$.hsNote=function(msg,typ,yes,sec){var div=$('<div class="alert alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert">&times;</button><div class="alert-body notebox" ></div></div>');div.find(".notebox").text(msg);if(typeof typ!=="string"){sec=yes;yes=typ;typ="info"}switch(typ){case"info":div.addClass("alert-info");break;case"succ":div.addClass("alert-success");break;case"warn":div.addClass("alert-warning");break;case"erro":div.addClass("alert-danger");break}var ctr=$("#notebox");if(ctr.length<1){ctr=$('<div id="notebox"></div>');ctr.prependTo(document.body)}ctr.show().prepend(div);if(sec===undefined){sec=5}if(sec>0){setTimeout(function(){div.alert("close")},sec*1000)}div.on("close.bs.alert",function(evt){if(ctr.children().size()<=1){ctr.hide()}if(yes){yes(evt)}div.remove()});div.alert();return div};$.hsWarn=function(msg,typ,yes,not){var div=$('<div class="alert alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert">&times;</button><div class="alert-body warnbox" ></div></div>');var mod=$('<div class="modal fade in"></div>').append(div);var box=div.find(".warnbox");var btt=$("<h4></h4>");var btu=$("<p></p>");var btn=$("<p></p>");var tit;var j=2;if(typeof typ!=="string"){j=1;not=yes;yes=typ;typ="info"}switch(typ){case"info":div.addClass("alert-info");tit=hsGetLang("info.title");break;case"succ":div.addClass("alert-success");tit=hsGetLang("succ.title");break;case"warn":div.addClass("alert-warning");tit=hsGetLang("warn.title");break;case"erro":div.addClass("alert-danger");tit=hsGetLang("erro.title");break;default:div.addClass("alert-info");tit=typ;break}btt.text(tit);box.text(msg);if(yes==null||$.isFunction(yes)){arguments[j+0]={click:yes,"class":"btn-primary",label:hsGetLang("ensure")}}if(not==null||$.isFunction(not)){arguments[j+1]={click:not,"class":"btn-default",label:hsGetLang("cancel")}}var end=null;for(var i=j;i<arguments.length;i=i+1){var v=arguments[i];if(v.label===undefined){if(v.close){end=v.click}if(v.title){btt.text(v.title)}if(v["class"]){div.addClass(v["class"])}continue}if(v["class"]===undefined){v["class"]="btn-default"}var btm=$('<button type="button" class="btn btn-md"></button>');btm.text(v.label).addClass(v["class"]).appendTo(btn);if(v.click){btm.on("click",v.click)}}var ini={show:true};if(btn.children().size()){ini.keyboard=false;ini.backdrop="static";var wrp=$("<div></div>");wrp.append(div.contents());div.addClass("warn1");wrp.addClass("warn2");div.append(wrp);btu.append(box.contents());div.find(".close").hide();btu.addClass("warn3");btn.addClass("warn4");box.append(btt);box.append(btu);box.append(btn);$.support.transition=undefined;mod.on("shown.bs.modal",function(){var wh=$(window).height();var mh=div.outerHeight();if(wh>mh){mh=Math.floor((wh-mh)/2);div.css("margin-top",mh+"px")}})}$(":focus").blur();btn.on("click","button",function(){mod.modal("hide")});div.on("close.bs.alert",function(){mod.modal("hide")});mod.on("hidden.bs.modal",function(evt){div.remove();mod.remove();if(end){end(evt)}});mod.modal(ini);div.alert();return div};$.fn.jqLoad=$.fn.load;$.fn.hsLoad=function(url,data,complete){if($.isFunction(data)){complete=data;data=undefined}if(!$.isFunction(complete)){complete=function(){}}var dat=data?hsSerialArr(data):[];this.data("href",url).data("data",dat).addClass("loadbox").addClass("loading");var pos;pos=url.indexOf("#");if(pos!=-1){url=url.substring(0,pos)}pos=url.indexOf(".html?");if(pos!=-1&&!hsGetParam(url,"_")&&!hsGetSeria(dat,"_")){url=url.substring(0,pos+5);dat=undefined}else{if(dat.length==0){dat=undefined}}url=hsFixUri(url);return $.fn.jqLoad.call(this,url,dat,function(){$(this).removeClass("loading").hsReady();complete.apply(this,arguments)})};$.fn.hsOpen=function(url,data,complete){var prt=$(this);var box;var ref;var tab;if(prt.is(".panes")){prt=prt.data("tabs");prt=prt.hsTadd(url);tab=prt[0];prt=prt[1]}else{if(prt.is(".tabs")){prt=prt.hsTadd(url);tab=prt[0];prt=prt[1]}else{if(prt.parent().is(".panes")){tab=prt.parent().data("tabs").children().eq(prt.index())}else{if(prt.parent().is(".tabs")){tab=prt;prt=prt.parent().data("panes").children().eq(tab.index())}}}}if(tab){ref=tab.parent().children().filter(".active");tab.show().find("a").click();if(tab.find("a b,a span").size()){tab.find("a b,a span").not(".close").text(hsGetLang("loading"))}else{tab.find("a").text(hsGetLang("loading"))}if(prt.children().size()){prt.children().hsCloze();prt.empty()}}else{ref=$('<div class="openbak"></div>').hide().append(prt.contents()).appendTo(prt)}box=$('<div class="openbox"></div>').appendTo(prt).data("ref",ref);box.hsLoad(url,data,complete);return box};$.fn.hsReady=function(){var box=$(this);box.find("*").contents().filter(function(){return this.nodeType===3&&/^\s+$/.test(this.nodeValue)}).remove();box.find("input").each(function(){$(this).addClass("input-"+$(this).attr("type"))});box.find(".dropdown-body").each(function(){var u=$(this).parent().is(".dropup");$(this).toggleClass("invisible",!u)});box.find(".i18n,[data-i18n]").each(function(){$(this).hsI18n()});box.find("[data-toggle=hsTabs]").each(function(){$(this).hsTabs()});box.find("[data-toggle=hsInit]").each(function(){$(this).hsInit()});if(!box.children("[data-toggle=hsInit],[data-module=hsInit]").size()){$(this).hsInit()}box.find("[data-module]").each(function(){var prnt=$(this);var opts=$(this).hsData();var func=$(this).attr("data-module");if(typeof(prnt[func])==="function"){prnt[func](opts)}});box.trigger("hsReady");box.find("[data-load]").each(function(){$(this).hsLoad($(this).attr("data-load"),$(this).attr("data-data"))});box.find("[data-open]").each(function(){$(this).hsOpen($(this).attr("data-open"),$(this).attr("data-data"))});box.find("[data-eval]").each(function(){eval("(function(){"+$(this).attr("data-eval")+"})").call(this)});return box};$.fn.hsClose=function(){var prt=$(this).parent();var box=$(this);var tab;if(prt.parent().is(".panes")){tab=prt.parent().data("tabs").children().eq(prt.index())}else{if(prt.parent().is(".tabs")){tab=prt;prt=prt.parent().data("panes").children().eq(tab.index());box=prt.children(".openbox")}}box.trigger("hsClose");box.hsCloze();if(tab){var idx=box.data("ref")?box.data("ref").index():0;var tbs=tab.parent().children();var pns=prt.parent().children();var pnt=prt.parent();if(tbs){tbs.removeClass("active").eq(idx).show().addClass("active")}if(pns){pns.hide().eq(idx).show()}if(tab.has(".close").size()){tab.remove();prt.remove()}pnt.trigger("hsCloze")}else{if(box.data("ref")){var ref=box.data("ref");prt.append(ref.contents());box.remove();ref.remove();prt.trigger("hsCloze")}else{if(box.closest(".modal").size()){box.closest(".modal").modal("hide")}else{if(box.closest(".alert").size()){box.closest(".alert").remove()}}}}return box};$.fn.hsCloze=function(){var box=$(this);$(document.body).find(".openbox").each(function(){if(!box.is(this)&&box.is($(this).data("rel"))){$(this).hsClose()}});return box};$.fn.hsTabs=function(rel){var box=$(this);if(!rel){rel=box.attr("data-target");if(rel){rel=box.hsFind(rel);rel.addClass("panes")}else{rel=box.siblings(".panes")}}box.addClass("tabs");rel.data("tabs",box);box.data("panes",rel);var act=box.children(".active");if(act.size()==0){act=box.children("li:first")}act.children("a").click();return box};$.fn.hsTadd=function(ref){var box=$(this);var tab;if(!ref){ref="";tab=[]}else{tab=box.find("[data-hrel='"+ref+"']").closest("li")}if(!tab.length){tab=$('<li><a href="javascript:;"><span></span><span class="close">&times;</span></a></li>');tab.appendTo(box).find("a").attr("data-hrel",ref);return[tab,$("<div></div>").appendTo(box.data("panes"))]}else{return[tab,$(box.data("tabs")).children().eq(tab.index())]}};$.fn.hsInit=function(cnf){if(cnf===undefined){cnf=$(this).hsData()}var box=$(this);if(box.is("h1,h2,h3")){box=box.parent()}var h=box.children("h1,h2,h3").first();if(h.length){cnf.title=h.text()}if(cnf.title){cnf.title=H$("&id",box)?cnf.title.replace("{DO}",cnf.update||hsGetLang("form.update")):cnf.title.replace("{DO}",cnf.create||hsGetLang("form.create"))}if(h.length){h.text(cnf.title)}if(box.is(".modal-body")){var a=box.closest(".modal");for(var k in cnf){var v=cnf[k];switch(k){case"modal":v="modal-"+v;a.find(".modal-dialog").addClass(v);break;case"title":a.find(".modal-title").text(v);break}}a.modal()}else{if(box.parent(".panes").size()||box.parent().parent(".panes").size()){var a=box.closest(".panes>*");a=box.closest(".panes").data("tabs").children().eq(a.index());for(var k in cnf){var v=cnf[k];switch(k){case"title":var x=a.find("a");var y=x.find("b,span").not(".close");if(y.size()){y.text(v)}else{x.text(v)}break}}}}return box};$.fn.hsI18n=function(rep){var box=$(this);var lng;if(box.attr("data-i18n")){lng=box.attr("data-i18n");lng=hsGetLang(lng,rep);box.text(lng)}else{if($(this).text()){lng=box.text();lng=hsGetLang(lng,rep);box.text(lng)}}if(box.attr("alt")){lng=box.attr("alt");lng=hsGetLang(lng,rep);box.attr("alt",lng)}if(box.attr("title")){lng=box.attr("title");lng=hsGetLang(lng,rep);box.attr("title",lng)}if(box.attr("placeholder")){lng=box.attr("placeholder");lng=hsGetLang(lng,rep);box.attr("placeholder",lng)}return box};$.fn.hsData=function(){var that=this.get(0);var conf=this.data();var nreg=/^data-\d+$/;var treg=/-\d+$/;var freg=/-\w/g;var frep=function(n){return n.substring(1).toUpperCase()};var vrep=function(v){if(/^(\{.*\}|\[.*\])$/.test(v)){v=eval("("+v+")")}else{if(/^(\(.*\))$/.test(v)){v=eval(v)}}return v};var mrep=function(v){if(!/^(\{.*\})$/.test(v)){v="{"+v+"}"}return eval("("+v+")")};this.each(function(){var a=this.attributes;if(a===undefined){return}var j=a.length;var i=0;for(;i<j;i++){var n=a[i].name;if(n.substring(0,5)=="data-"){n=n.substring(5)}else{continue}var v=a[i].value;if("data"==n){v=mrep.call(that,v);jQuery.extend(conf,v)}else{if(nreg.test(n)){var o=v.indexOf(":");n=v.substring(0,o);v=v.substring(1+o);n=jQuery.trim(n);v=jQuery.trim(v);v=vrep.call(that,v);hsSetValue(conf,n,v)}else{if(treg.test(n)){n=n.replace(treg,"");n=n.replace(freg,frep);if(conf[n]===undefined){conf[n]=[]}v=vrep.call(that,v);conf[n].push(v)}else{n=n.replace(freg,frep);v=vrep.call(that,v);conf[n]=v}}}}});return conf};$.fn._hsConfig=$.fn.hsData;$.fn.hsFind=function(selr){var elem=this;selr=$.trim(selr);var flag=selr.charAt(0);var salr=selr.substr(1);salr=$.trim(salr);switch(flag){case"@":do{var x;x=elem.closest(".panes");if(x.size()){elem=x;break}x=elem.closest(".openbox");if(x.size()){elem=x;break}x=elem.closest(".loadbox");if(x.size()){elem=x;break}elem=$(document)}while(false);return salr?$(salr,elem):elem;case"%":do{var x;x=elem.closest(".loadbox");if(x.size()){elem=x;break}x=elem.closest(".openbox");if(x.size()){elem=x;break}elem=$(document)}while(false);return salr?$(salr,elem):elem;case"^":case"<":elem=elem.parent();if(!salr){return elem}var a=salr.split("|",2);if(a.length>1){return elem.closest(salr)}else{return elem.closest(a[0]).hsFind(a[1])}case">":return elem.children(salr);case"~":return elem.siblings(salr);case"+":return elem.next(salr);case"-":return elem.prev(salr);case".":case":":case"[":return elem.find(selr);case"*":return $(salr);default:return $(selr)}};$.fn._hsTarget=$.fn.hsFind;$.fn._hsModule=function(func,opts){var elem=this;var name=func.name||/^function (\w+)/.exec(func.toString())[1];var inst=elem.data(name);if(!inst){inst=new func(opts,elem);elem.data(name,inst);elem.addClass(name)}if(opts){for(var k in opts){if("_"===k.substring(0,1)||inst[k]!==undefined){inst[k]=opts[k]}}}return inst};$.propHooks.choosed={get:function(elem){return elem.checked?true:(elem.indeterminate?null:false)},set:function(elem,stat){if(stat===null){elem.checked=false;elem.indeterminate=true}else{elem.checked=!!stat;elem.indeterminate=false}}};$(document).ajaxError(function(evt,xhr,cnf){var rst=hsResponObj(xhr);if(typeof(cnf.funcName)==="undefined"){return}if(typeof(cnf.trigger)!=="undefined"){var btn=$(cnf.trigger);btn.trigger(cnf.funcName+"Error",evt,rst)}if(typeof(cnf.context)!=="undefined"){var box;if(typeof(cnf.context.context)!=="undefined"){box=$(cnf.context.context)}else{box=$(cnf.context)}box.trigger(cnf.funcName+"Error",evt,rst)}});$(document).on("click","[data-toggle=hsLoad]",function(evt){var box=$(this).attr("data-target");var url=$(this).attr("data-href");var dat=$(this).attr("data-data");var bak=$(this).attr("data-back");url=hsFixPms(url,this);if(box){box=$(this).hsFind(box);box.hsLoad(url,dat)}else{box=$.hsOpen(url,dat)}if(bak){var btn=this;box.on("saveBack",function(evt){eval("(function(event){"+bak+"})").call(btn,evt);$(btn).trigger(evt)})}evt.stopPropagation()}).on("click","[data-toggle=hsOpen]",function(evt){var box=$(this).attr("data-target");var url=$(this).attr("data-href");var dat=$(this).attr("data-data");var bak=$(this).attr("data-back");url=hsFixPms(url,this);if(box){box=$(this).hsFind(box);box.hsOpen(url,dat)}else{box=$.hsOpen(url,dat)}if(bak){var btn=this;box.on("saveBack",function(evt){eval("(function(event){"+bak+"})").call(btn,evt);$(btn).trigger(evt)})}evt.stopPropagation()}).on("click","[data-toggle=hsClose],.close,.cancel",function(evt){var box;var ths=$(this);do{if(ths.is("li>.close")){return}if(ths.is("li .close")){box=ths.closest("a");break}box=ths.closest(".modal-header").next();if(box.is(".openbox")){box=box.closest(".modal");break}box=ths.closest(".notebox, .warnbox");if(box.is(".alert-body")){box=box.closest(".alert");break}box=ths.closest(".openbox");if(box.is(".modal-body")){box=box.closest(".modal");break}if(box.size()&&box.closest(".alert,.modal").size()){break}if(ths.closest(".alert,.modal").size()){return}}while(false);if(ths.closest(".dont-close",box[0]).size()){return}box.hsClose();evt.stopPropagation()}).on("click",".tabs > li > a",function(evt){var ths=$(this);var tab=ths.parent();var nav=tab.parent();var pns=nav.data("panes");var pne=pns?pns.children().eq(tab.index()):$();if(tab.is(".dont-close")){return}if(nav.is(".breadcrumb")){tab.nextAll().find("a").each(function(){$(this).hsClose()})}if(ths.is("[data-href]")){var ref;ref=ths.attr("data-href");ths.removeAttr("data-href");pne.hsOpen(ref)}tab.show().addClass("active").siblings().removeClass("active");pne.show().siblings().hide();evt.stopPropagation()}).on("click",".dropdown-toggle",function(evt){if($(evt.target).is(".dropdown-deny")){return}var body=$(this).siblings(".dropdown-body");if(body.size()==0){return}var cont=$(this).parent();cont.toggleClass("dropup");body.toggleClass("invisible",!cont.is(".dropup"));evt.stopPropagation()}).on("click","select[multiple]",function(evt){if(evt.shiftKey||evt.ctrlKey||evt.altKey){return}var vals=$(this).data("vals")||[];var valz=$(this).val();if(!valz||valz.length===0){vals=[]}else{$.each(valz,function(x,v){var i=$.inArray(v,vals);if(i>=0){vals.splice(i,1)}else{vals.push(v)}})}$(this).data("vals",vals);$(this).val(vals)}).on("click",".back-crumb a",function(){var nav=$(this).closest(".breadcrumb");nav.find("li:last a").hsClose();nav.find("li:last a").click()}).on("hsReady hsCloze",".backable.panes",function(){var nav=$(this).siblings(".breadcrumb")||$(this).data("tabs");if(nav.children().not(".back-crumb,.home-crumb").size()){nav.show().removeClass("hide").removeClass("invisible")}else{nav.hide()}});$(function(){$(document).hsReady()})})(jQuery);

/**
 * Form Module
 * @author Hongs
 * @version 15.12.16
 */
function HsForm(a,b){b=jQuery(b);b.data("HsForm",this);b.addClass("HsForm");var o=b.closest(".loadbox");var h=b.find("form");var e=hsGetValue(a,"loadUrl");var j=hsGetValue(a,"saveUrl");var l=hsGetValue(a,"idKey","id");var f=hsGetValue(a,"mdKey","md");if(!h.length){h=b}this.context=b;this.loadBox=o;this.formBox=h;this._url="";this._data=[];if(a){for(var d in a){if("_"===d.substring(0,1)||this[d]!==undefined){this[d]=a[d]}else{if("$"===d.substring(0,1)){this.rules[d.substring(1)]=a[d]}else{if(":"===d.substring(0,1)){this.rmsgs[d.substring(1)]=a[d]}}}}}var m=hsSerialArr(o);if(e){e=hsFixPms(e,m)}if(j){j=hsFixPms(j,m)}var g,c,p;for(g=0;g<m.length;g++){c=m[g].name;p=m[g].value;if(c===l&&p==="0"){continue}h.find("[name='"+c+"']").not(".form-ignored").val(p);h.find("[data-fn='"+c+"']").val(p);h.find("[data-pn='"+c+"']").val(p)}if(e&&(hsGetParam(e,l)||hsGetParam(e,f))){this.load(e,m)}else{this.loadBack({})}this.valiInit();this.saveInit(j)}HsForm.prototype={load:function(a,b){if(a){this._url=a}if(b){this._data=hsSerialArr(b)}jQuery.hsAjax({url:this._url,data:this._data,type:"POST",dataType:"json",funcName:"load",async:false,cache:false,context:this,success:this.loadBack})},loadBack:function(a){a=hsResponObj(a);if(a.ok===false){return}this.formBox.trigger("loadBack",[a,this]);if(a["enum"]){this.fillEnum(a["enum"])}if(a.info){this.fillInfo(a.info)}else{if(a.list&&a.list[0]){this.fillInfo(a.list[0])}else{this.fillInfo({})}}this.formBox.trigger("loadOver",[a,this])},fillEnum:function(h){var f,d,e,c,g,b,a;f=this.formBox.find("[data-fn],select[name]").not(".form-ignored");d={};e={};for(c=0;c<f.length;c++){a=jQuery(f[c]);g=a.attr("name");if(!g){g=a.attr("data-fn")}if(!g){continue}d[g]=g;e[g]=a.attr("data-ft")}this._enum=h;for(g in d){a=hsGetValue(h,g);if(a===undefined){a=h[g]}c=this.formBox.find('[name="'+g+'"]').not(".form-ignored");if(c.length===0){c=this.formBox.find('[data-fn="'+g+'"]').not(".form-ignored")}b=e[g];if(g&&this["_fill_"+g]!==undefined){a=this["_fill_"+g].call(this,c,a,g,"enum")}else{if(b&&this["_fill_"+b]!==undefined){a=this["_fill_"+b].call(this,c,a,g,"enum")}}if(!a&&a!==0&&a!==""){continue}if(c.is("select")){this._fill__select(c,a,g,"enum")}else{this._fill__review(c,a,g,"enum")}}delete this._enum},fillInfo:function(info){var fds,fns,fts,fvs,fls,i,n,t,v,f;fds=this.formBox.find("[data-fn],input[name],select[name],textarea[name]").not(".form-ignored");fns={};fts={};fvs={};fls={};for(i=0;i<fds.length;i++){v=jQuery(fds[i]);n=v.attr("name");if(!n){n=v.attr("data-fn")}if(!n){continue}fns[n]=n;fts[n]=v.attr("data-ft");fvs[n]=v.data("fv");f=v.data("fl");if(f&&typeof f!="function"){try{f=eval("(function(form, v, n){return "+f+";})")}catch(e){throw new Error("Parse list data-fl error: "+e)}v.data("fl",f)}if(f){fls[n]=f}}this._info=info;for(n in fns){v=hsGetValue(info,n);if(v===undefined){v=info[n]}if(!v){v=fvs[n]}i=this.formBox.find('[name="'+n+'"]').not(".form-ignored");if(i.length===0){i=this.formBox.find('[data-fn="'+n+'"]').not(".form-ignored");if(fts[n]===undefined){fts[n]="_review"}}t=fts[n];f=fls[n];if(f){v=f.call(i,this,v,n)}else{if(n&&this["_fill_"+n]!==undefined){v=this["_fill_"+n].call(this,i,v,n,"info")}else{if(t&&this["_fill_"+t]!==undefined){v=this["_fill_"+t].call(this,i,v,n,"info")}}}if(!v&&v!==0&&v!==""){continue}if(i.attr("type")=="checkbox"||i.attr("type")=="radio"){jQuery.each(!jQuery.isArray(v)?[v]:v,function(j,u){i.filter("[value='"+u+"']").prop("checked",true).change()})}else{if(i.attr("type")=="file"){i.attr("data-value",v).change()}else{if(i.is("input,select,textarea")){i.val(v).change()}else{i.text(v)}}}}delete this._info},saveInit:function(h){var b=this.formBox.attr("action")||h;var i=this.formBox.attr("method");var e=this.formBox.attr("enctype");var f=this.formBox;var g=this;f.attr("action",hsFixUri(b));if(e==="multipart/form-data"){if(f.attr("target")==null){var c="_"+((new Date()).getTime()%86400000)+"_"+Math.floor(Math.random()*1000);var a="width:0; height:0; border:0; margin:0; padding:0; overflow:hidden; visibility:hidden;";var d=jQuery('<iframe src="about:blank" name="'+c+'" style="'+a+'"></iframe>');f.attr("target",c).before(d);d.on("load",function(){var j=d[0].contentDocument||d[0].contentWindow.document;if(j.location.href=="about:blank"){return}var k=j.body.innerHTML.replace(/(^<PRE.*?>|<\/PRE>$)/igm,"");g.saveBack(k)})}}else{f.on("submit",function(j){if(j.isDefaultPrevented()){return}j.preventDefault();jQuery.hsAjax({url:b,data:hsSerialArr(f),type:i||"POST",dataType:"json",funcName:"save",async:false,cache:false,global:false,context:g,complete:g.saveBack,error:function(){return false}})})}},saveBack:function(b){b=hsResponObj(b,true);if(b.ok){var a=jQuery.Event("saveBack");this.formBox.trigger(a,[b,this]);if(a.isDefaultPrevented()){return}this.loadBox.hsClose();if(b.msg){this.note(b.msg,"succ")}}else{var a=jQuery.Event("saveFail");this.formBox.trigger(a,[b,this]);if(a.isDefaultPrevented()){return}if(b.errs){this.seterror(b.errs)}else{if(!b.msg){b.msg=hsGetLang("error.unkwn")}}if(b.msg){this.warn(b.msg,"warn")}}},note:function(){jQuery.hsNote.apply(self,arguments)},warn:function(){jQuery.hsWarn.apply(self,arguments)},_fill__review:function(l,q,b,r){if(r==="enum"){l.data("enum",q);return q}var p=l.data("enum");if(p){var f=l.attr("data-vk");if(!f){f=0}var r=l.attr("data-tk");if(!r){r=1}var g,j,h,d={};var o=l.is("ul")?"<li></li>":"<span></span>";l.empty().removeData("enum");if(!jQuery.isArray(q)){q=[q]}for(g=0;g<p.length;g++){h=p[g];d[h[f]]=h[r]}for(g=0;g<q.length;g++){j=q[g];h=d[q[g]];l.append(jQuery(o).text(h)).attr("data-code",j)}return}if(l.is("ul")){var q=l.attr("data-vk");if(!f){f=0}var r=l.attr("data-tk");if(!r){r=1}var g,j,h;l.empty();var o="<li></li>";for(g=0;g<q.length;g++){j=g;h=q[g];if(jQuery.isPlainObject(h)||jQuery.isArray(h)){j=h[f];h=h[r]}l.append(jQuery(o).text(h)).attr("data-code",j)}return}if(l.is("img,audio,video")){l.attr("src",q);return}if(l.is("object")){l.attr("data",q);return}if(l.is("a")){l.attr("href",q);return}return q},_fill__select:function(f,g,b,h){if(h!=="enum"){return g}var c=f.attr("data-vk");if(!c){c=0}var j=f.attr("data-tk");if(!j){j=1}for(var e=0;e<g.length;e++){var d=hsGetValue(g[e],c);if(d=="*"){continue}var h=hsGetValue(g[e],j);var a=jQuery("<option></option>");a.val(d).text(h).data("data",g[e]);f.append(a)}f.change().click()},_fill__radio:function(f,a,h,e){if(e!=="enum"){return a}var g=f.attr("data-vk");if(!g){g=0}var b=f.attr("data-tk");if(!b){b=1}for(var d=0;d<a.length;d++){var c=jQuery('<label><input type="radio"/><span></span></label>');c.find("input").attr("name",h).data(a[d]).val(hsGetValue(a[d],g));c.find("span").text(hsGetValue(a[d],b));f.append(c)}f.find(":radio").first().change()},_fill__check:function(f,a,h,e){if(e!=="enum"){return a}var g=f.attr("data-vk");if(!g){g=0}var b=f.attr("data-tk");if(!b){b=1}for(var d=0;d<a.length;d++){var c=jQuery('<label><input type="checkbox"/><span></span></label>');c.find("input").attr("name",h).data(a[d]).val(hsGetValue(a[d],g));c.find("span").text(hsGetValue(a[d],b));f.append(c)}f.find(":checkbox").first().change()},_fill__checkset:function(k,o,b,q){if(q!=="enum"){return o}var d=k.attr("data-vk");if(!d){d=0}var y=k.attr("data-tk");if(!y){y=1}var c=k.attr("data-vl");if(!c){c=0}var r=k.attr("data-tl");if(!r){r=1}var h=this._fill__checkset_body_class||"checkbox";var a=this._fill__checkset_item_class||"col-md-6";if(o!==undefined){for(var f=0;f<o.length;f++){var p=o[f][c];var x=o[f][r];var m=jQuery('<fieldset><legend class="dropdown-toggle"><input type="checkbox" class="checkall dropdown-deny"/>&nbsp;<span></span><b class="caret"></b></legend><div class="dropdown-body '+h+'"></div></fieldset>');m.find("span").first().text(x);k.append(m);m=m.find("div");for(var e=0;e<p.length;e++){var l=p[e];var g=jQuery('<label class="'+a+'"><input type="checkbox"/><span></span></label>');g.find("input").attr("name",b).data(l).val(hsGetValue(l,d));g.find("span").text(hsGetValue(l,y));m.append(g)}}}k.find(":checkbox").first().change();k.hsReady()},_fill__htime:function(e,a,d){if(a===undefined){return a}var c=new Date();var b=hsPrsDate(a,hsGetLang("datetime.format"));if(c.getFullYear()==b.getFullYear()&&c.getMonth()==b.getMonth()&&c.getDate()==b.getDate()){return hsGetLang("time.today",[hsFmtDate(a,hsGetLang("time.format"))])}else{return hsFmtDate(a,hsGetLang("date.format"))}},_fill__hdate:function(e,a,d){if(a===undefined){return a}var c=new Date();var b=hsPrsDate(a,hsGetLang("date.format"));if(c.getFullYear()==b.getFullYear()&&c.getMonth()==b.getMonth()&&c.getDate()==b.getDate()){return hsGetLang("date.today")}else{return hsFmtDate(a,hsGetLang("date.format"))}},_fill__datetime:function(c,a,b){if(a===undefined){return a}return hsFmtDate(a,hsGetLang("datetime.format"))},_fill__date:function(c,a,b){if(a===undefined){return a}return hsFmtDate(a,hsGetLang("date.format"))},_fill__time:function(c,a,b){if(a===undefined){return a}return hsFmtDate(a,hsGetLang("time.format"))},_fill__html:function(c,a,b){if(a===undefined){return a}c.html(a);return false},valiInit:function(){var a=this;this.formBox.attr("novalidate","novalidate");this.formBox.on("reset",function(){return a.verified()});this.formBox.on("submit",function(){return a.verifies()});this.formBox.on("change","input,select,textarea,[data-fn]",function(){var c=jQuery(this);var b=c.attr("name")||c.attr("data-fn");if(b){a.validate(b)}})},verified:function(){this.formBox.find(".form-group").removeClass("has-error");this.formBox.find(".help-block").addClass("invisible");return true},verifies:function(){this.verified();var b=true;var a={};this.formBox.find("input,select,textarea,[data-fn]").not(".form-ignored").each(function(){var e=jQuery(this);var f=e.attr("name")||e.attr("data-fn");if(!f){return true}if(a[f]===undefined){a[f]=e}else{a[f]=a[f].add(e)}});for(var c in a){var d=this.validate(a[c]);if(d==false){b=false}}if(!b){this.warn(hsGetLang("form.invalid"),"warn")}return b},validate:function(c){if(c===undefined){this.verifies();return}if(typeof c=="string"){c=this.formBox.find('[name="'+c+'"],[data-fn="'+c+'"]').not(".form-ignored")}else{c=jQuery(c)}for(var a in this.rules){if(!c.is(a)){continue}var d=c.val();var b=this.rules[a].call(this,d,c);if(b!==true){b=b||hsGetLang("form.haserror");this.seterror(c,b);return false}else{this.seterror(c)}}return true},seterror:function(d,c){if(c===undefined&&jQuery.isPlainObject(d)){this.verified();for(var g in d){var f=d[g];this.seterror(g,f)}return}if(typeof d=="string"){d=this.formBox.find('[name="'+d+'"],[data-fn="'+d+'"]').not(".form-ignored")}else{d=jQuery(d)}var a=d.closest(".form-group");var b=a.find(".help-block");if(b.size()==0){b=jQuery('<p class="help-block"></p>').appendTo(a)}if(c==undefined){a.removeClass("has-error");b.addClass("invisible")}else{a.addClass("has-error");b.removeClass("invisible");b.text(c)}},geterror:function(d,c,e){var f=c.replace(/^form\./,"").replace(/\./g,"-");f="data-"+f+"-error";f=d.attr(f)||d.attr("data-error");if(f){c=f}if(this.rmsgs[c]){c=this.rmsgs[c]}var b=d.attr("data-label");if(b==null){b=d.closest(".form-group").find(".control-label").text()}if(b){if(jQuery.isArray(e)){var g={};for(var a=0;a<e.length;a++){g[a+""]=e[a]}e=g}else{if(e==null){e={}}}e._=hsGetLang(b)}return hsGetLang(c,e)},rmsgs:{},rules:{"[required],[data-required]":function(d,c){if(c.is(":radio,:checkbox")){if(!c.filter(":checked").length){return this.geterror(c,"form.requires")}}else{if(c.is(".checkbox")){if(!c.find(":checked").length){return this.geterror(c,"form.requires")}}else{if(c.is("ul,div")){if(!c.find(":hidden").length){return this.geterror(c,"form.requires")}}else{if(c.is(":file")){if(!d&&!c.data("value")){return this.geterror(c,"form.requires")}var a=c.filter(":hidden");var b=c.parent().closest(".file-input");if(!d&&!a.size()&&b.size()){return this.geterror(c,"form.requires")}}else{if(c.is("select")){if(!d){return this.geterror(c,"form.requires")}}else{if(!d){return this.geterror(c,"form.required")}}}}}}return true},"[pattern],[data-pattern]":function(d,c){var a=c.attr("pattern")||c.attr("data-pattern");var b=/^\/(.*)\/([gim])?$/.exec(a);if(b){a=new RegExp(b[1],b[2])}else{a=new RegExp(a)}if(!a.test(d)){return this.geterror(c,"form.is.not.match")}return true},"[maxlength],[data-maxlength]":function(c,b){var a=b.attr("maxlength")||b.attr("data-maxlength");if(c.length>a){return this.geterror(b,"form.gt.maxlength",[a])}return true},"[minlength],[data-minlength]":function(c,b){var a=b.attr("minlength")||b.attr("data-minlength");if(c.length<a){return this.geterror(b,"form.lt.minlength",[a])}return true},"[max],[data-max]":function(d,c){var b=this.rules["[type=number],.input-number"].call(this,d,c);if(b!==true){return b}var a=c.attr("max")||c.attr("data-max");if(parseFloat(d)>parseFloat(a)){return this.geterror(c,"form.gt.max",[a])}return true},"[min],[data-min]":function(d,c){var b=this.rules["[type=number],.input-number"].call(this,d,c);if(b!==true){return b}var a=c.attr("min")||c.attr("data-min");if(parseFloat(d)<parseFloat(a)){return this.geterror(c,"form.lt.min",[a])}return true},"[type=number],.input-number":function(b,a){if(!b&&a[0]&&a[0].validity&&a[0].validity.badInput){return this.geterror(a,"form.is.not.number")}if(!/^-?[0-9]*(\.[0-9]+)?$/.test(b)){return this.geterror(a,"form.is.not.number")}return true},"[type=email],.input-email":function(b,a){if(!/^([a-z0-9_\.\-\+]+)@([\da-z\.\-]+)\.([a-z\.]{2,6})$/i.test(b)){return this.geterror(a,"form.is.not.email")}return true},"[type=url],.input-url":function(b,a){if(!/^(https?:\/\/)?[\da-z\.\-]+\.[a-z\.]{2,6}(:\d+)?(\/[^\s]*)?$/i.test(b)){return this.geterror(a,"form.is.not.url")}return true},"[type=tel],.input-tel":function(b,a){if(!/^(\+\d{1,3})?\d{3,}$/i.test(b)){return this.geterror(a,"form.is.not.tel")}return true},"[data-validate]":function(d,c){var b=c.attr("data-validate");try{if(c.data(b)){return c.data(b).call(this,d,c)}else{if(window[b]){return window[b].call(this,d,c)}else{if(window.console){if(window.console.error){window.console.error(b+" not found!")}else{window.console.log(b+" not found!")}}}}return false}catch(a){if(window.console){if(window.console.error){window.console.error(b+" run error: "+a,d,c)}else{window.console.log(b+" run error: "+a,d,c)}}return false}},"[data-verify]":function(f,c,b){if(!f){return true}var a=true;var e=this.formBox;var d={n:c.attr("name"),v:f};if(!b){b=c.attr("data-verify")}b=b.replace(/\$\{(.*?)\}/g,function(g,h){return e.find("[name='"+h+"']").not(".form-ignored").val()||""});jQuery.hsAjax({url:b,data:d,type:"POST",dataType:"json",funcName:"vali",async:false,cache:false,context:this,success:function(g){if(g.list!==undefined){a=g.list.length>0}else{if(g.info!==undefined){a=!jQuery.isEmptyObject(g.info)}else{if(g.rows!==undefined){a=g.rows>0?true:(g.msg?g.msg:false)}else{a=g.ok?true:(g.msg?g.msg:false)}}}}});return a},"[data-unique]":function(c,b){var a=this.rules["[data-verify]"].call(this,c,b,b.attr("data-unique"));if(typeof a==="string"){return a}else{if(!a){return this.geterror(b,"form.is.not.unique")}}return true},"[data-exists]":function(c,b){var a=this.rules["[data-verify]"].call(this,c,b,b.attr("data-exists"));if(typeof a==="string"){return a}else{if(!a){return this.geterror(b,"form.is.not.exists")}}return true},"[data-repeat]":function(d,c){var b=c.attr("data-repeat");var a=this.formBox.find("[name="+b+"],[data-fn="+b+"]").not(".form-ignored");if(a.val()!=d){return this.geterror(c,"form.is.not.repeat")}return true},"[data-relate]":function(d,c){var b=c.attr("data-relate");var a=this.formBox.find("[name="+b+"],[data-fn="+b+"]").not(".form-ignored");if(a.val()!=""){this.validate(b)}return true}}};jQuery.fn.hsForm=function(a){return this._hsModule(HsForm,a)};(function(a){a(document).on("submit","form",function(b){if(b.isDefaultPrevented()){return}var c=a(this).find(":submit");c.prop("disabled",true);c.data("txt",c.text());c.text(hsGetLang("form.sending"))}).on("saveBack saveFail","form",function(){var c=a(this).find(":submit");var b=c.data("txt");if(b){c.text(b)}c.prop("disabled",false)}).on("change","fieldset .checkall",function(b){this.indeterminate=false;var d=a(this).closest("fieldset");var c=a(this).prop("checked");d.find(":checkbox:not(.checkall)").prop("checked",c).trigger("change")}).on("change","fieldset :checkbox:not(.checkall)",function(d){var f=a(this).closest("fieldset");var c=f.find(":checkbox:not(.checkall)").length;var b=f.find(":checkbox:not(.checkall):checked").length;var e=c&&c==b?true:(b&&c!=b?null:false);f.find(".checkall").prop("choosed",e)}).on("click","[data-toggle=hsEdit]",function(b){var f=a(this).closest(".HsForm").data("HsForm");var e=function(){a(this).on("saveBack",function(h,j,g){var i=jQuery.Event("saveBack");i.relatedTarget=h.target;i.relatedHsInst=g;f.formBox.trigger(i,[j,f]);if(i.isDefaultPrevented()){return}f.load()})};var d=a(this).attr("data-target");var c=a(this).attr("data-href");c=hsFixPms(c,this);if(d){d=a(this).hsFind(d);d.hsOpen(c,e)}else{a.hsOpen(c,e)}b.stopPropagation()})})(jQuery);

/**
 * List Module
 * @author Hongs
 * @version 15.12.16
 */
function HsList(a,b){b=jQuery(b);b.data("HsList",this);b.addClass("HsList");var q=b.closest(".loadbox");var c=b.find(".listbox");var p=b.find(".pagebox");var j=b.find(".findbox");var i=hsGetValue(a,"loadUrl");var f=hsGetValue(a,"sendUrls");var e=hsGetValue(a,"openUrls");this.sortKey=hsGetValue(a,"sortKey",hsGetConf("ob.key","ob"));this.pageKey=hsGetValue(a,"pageKey",hsGetConf("pn.key","pn"));this.pagsKey=hsGetValue(a,"pagsKey",hsGetConf("gn.key","gn"));this.rowsKey=hsGetValue(a,"rowsKey",hsGetConf("rn.key","rn"));this.pagsNum=hsGetValue(a,"pagsKey","");var l=hsSerialMix(hsSerialArr(i),hsSerialArr(q));this.pagsNum=hsGetSeria(l,this.pagsKey)||this.pagsNum;this.rowsNum=hsGetSeria(l,this.rowsKey);if(this.pagsNum==""){this.pagsNum=hsGetConf("pags.for.page",5)}if(this.rowsNum==""){this.pagsNum=hsGetConf("pags.for.page",20)}this.context=b;this.loadBox=q;this.listBox=c;this.pageBox=p;this._url="";this._data=[];if(a){for(var h in a){if("_"===h.substring(0,1)||this[h]!==undefined){this[h]=a[h]}}}if(i){i=hsFixPms(i,q)}var o=this;var g,d,t;function s(v){var z=jQuery(this);var k=v.data[1];var w=v.data[2];var x=z.closest(".tooltip");if(x.length){z=x.data("trigger")}if(typeof(w)==="function"){w.call(z,k,o);return}var y;if(-1!=jQuery.inArray(c[0],z.parents())){y=o.getRow(z)}else{y=o.getAll()}if(y==null){return}w=hsFixPms(w,q);o.send(z,k,w,y)}if(f){jQuery.each(f,function(m,k){switch(k.length){case 3:d=k[0];t=k[1];g=k[2];break;case 2:d=k[0];t=k[1];g=undefined;break;default:return}if(typeof(d)==="string"){b.on("click",d,[d,g,t],s)}else{if(d){d.on("click",[d,g,t],s)}}})}function r(w){var z=jQuery(this);var k=w.data[1];var x=w.data[2];switch(k){case"{CONTEXT}":k=b;break;case"{LOADBOX}":k=q;break;case"{AUTOBOX}":k="@";default:if(k){k=z.hsFind(k)}}var y=z.closest(".tooltip");if(y.length){z=y.data("trigger")}if(typeof(x)==="function"){x.call(z,k,o);return}if(0<=x.indexOf("{ID}")){var v;if(0<=jQuery.inArray(c[0],z.parents())){v=o.getRow(z)}else{v=o.getOne()}if(v==null){return}v=v.val();x=x.replace("{ID}",encodeURIComponent(v))}x=hsFixPms(x,q);o.open(z,k,x)}if(e){jQuery.each(e,function(m,k){switch(k.length){case 3:d=k[0];t=k[1];g=k[2];break;case 2:d=k[0];t=k[1];g=undefined;break;default:return}if(typeof(d)==="string"){b.on("click",d,[d,g,t],r)}else{if(d){d.on("click",[d,g,t],r)}}})}if(j.length){j.on("submit",function(){o.load(i,this);return false})}if(i){this.load(i,j)}}HsList.prototype={load:function(a,b){if(a){this._url=a}if(b){this._data=hsSerialArr(b)}jQuery.hsAjax({url:this._url,data:this._data,type:"POST",dataType:"json",funcName:"load",async:false,cache:false,context:this,success:this.loadBack})},loadBack:function(a){a=hsResponObj(a);if(a.ok===false){return}this.listBox.trigger("loadBack",[a,this]);if(a.list){this.fillList(a.list)}if(a.page){this.fillPage(a.page)}else{if(a.list&&a.list.length){this.fillPage({uncertain:1})}else{this.fillPage({err:1})}}this.listBox.trigger("loadOver",[a,this])},fillList:function(list){var ths,th,tb,tr,td,i,j,n,t,v,f;ths=this.listBox.find("thead th,thead td");tb=this.listBox.find("tbody");tb.empty();var sn=hsGetSerias(this._data,this.sortKey);if(sn.length==0){sn=hsGetParam(this._url,this.sortKey)}else{sn=sn[0]}for(i=0;i<ths.length;i++){th=jQuery(ths[i]);f=th.data("fl");if(f&&typeof f!="function"){try{f=eval("(function(list, v, n){return "+f+";})")}catch(e){throw new Error("Parse list data-fl error: "+e)}th.data("fl",f)}if(th.hasClass("sortable")){if(th.find(".sort-ico").size()==0){var that=this;th.append('<span class="sort-ico"></span>');th.click(function(){var td=jQuery(this);var fn=td.attr("data-ob")||td.attr("data-fn");var sn="";if(td.hasClass("sort-a-z")){sn="-"+fn}else{if(!td.hasClass("sort-z-a")){sn=fn}}hsSetSeria(that._data,that.sortKey,sn);that.load()})}var fn=th.attr("data-ob")||th.attr("data-fn");th.removeClass("sort-a-z sort-z-a");if(sn==fn){th.addClass("sort-a-z")}else{if(sn=="-"+fn){th.addClass("sort-z-a")}}}}for(i=0;i<list.length;i++){tr=jQuery("<tr></tr>");tb.append(tr);this._info=list[i];for(j=0;j<ths.length;j++){th=jQuery(ths[j]);td=jQuery("<td></td>");td.appendTo(tr);td.attr("class",th.attr("class"));n=th.attr("data-fn");t=th.attr("data-ft");v=th.data("fv");f=th.data("fl");if(n){var x=hsGetValue(list[i],n);if(x===undefined){x=list[i][n]}if(x){v=x}}if(f){v=f.call(td,this,v,n)}else{if(n&&this["_fill_"+n]!==undefined){v=this["_fill_"+n].call(this,td,v,n)}else{if(t&&this["_fill_"+t]!==undefined){v=this["_fill_"+t].call(this,td,v,n)}}}if(!v&&v!==0&&v!==""){continue}td.text(v)}}if(typeof(this._info)!=="undefined"){delete this._info}},fillPage:function(h){switch(h.ern){case 2:case"2":hsSetSeria(this._data,this.pageKey,1);this.pageBox.empty().append('<div class="alert alert-warning">'+(this._above_err||hsGetLang("list.above"))+"</div>");this.listBox.hide();var g=this;setTimeout(function(){g.load()},5000);return;case 1:case"1":this.pageBox.empty().append('<div class="alert alert-warning">'+(this._empty_err||hsGetLang("list.empty"))+"</div>");this.listBox.hide();return;default:this.pageBox.empty();this.listBox.show()}var e,a,k,b,f,g=this;a=h.page?parseInt(h.page):1;k=h.pagecount?parseInt(h.pagecount):1;b=a-Math.floor(this.pagsNum/2);if(b<1){b=1}f=b+this.pagsNum-1;if(f>k){f=k}b=f-this.pagsNum+1;if(b<1){b=1}var c=jQuery('<ul class="pagination"></ul>').appendTo(this.pageBox);var d=c;var j=c;if(1<a){d.append(jQuery('<li class="page-prev"><a href="javascript:;" data-pn="'+(a-1)+'" title="'+hsGetLang("list.prev.page")+'">&lsaquo;</a></li>'))}else{d.append(jQuery('<li class="page-prev disabled"><a href="javascript:;" title="'+hsGetLang("list.prev.page")+'">&lsaquo;</a></li>'))}if(1<b){d.append(jQuery('<li class="page-home"><a href="javascript:;" data-pn="'+1+'" title="'+1+'">&laquo;</a></li>'))}else{d.append(jQuery('<li class="page-home disabled"><a href="javascript:;" title="'+1+'">&laquo;</a></li>'))}for(e=b;e<f+1;e++){j.append(jQuery('<li class="page-link'+(e===a?" active":"")+'"><a href="javascript:;" data-pn="'+e+'" title="'+e+'">'+e+"</a></li>"))}if(k>f){d.append(jQuery('<li class="page-last"><a href="javascript:;" data-pn="'+k+'" title="'+k+'">&raquo;</a></li>'))}else{d.append(jQuery('<li class="page-last disabled"><a href="javascript:;" title="'+k+'">&raquo;</a></li>'))}if(k>a){d.append(jQuery('<li class="page-next"><a href="javascript:;" data-pn="'+(a+1)+'" title="'+hsGetLang("list.next.page")+'">&rsaquo;</a></li>'))}else{d.append(jQuery('<li class="page-next disabled"><a href="javascript:;" title="'+hsGetLang("list.next.page")+'">&rsaquo;</a></li>'))}if(h.uncertain&&k==f+1){j.find(".page-last").addClass("page-more").find("a").html("&hellip;")}this.pageBox.show();this.pageBox.find("[data-pn="+a+"]").addClass("page-curr");this.pageBox.find("[data-pn]").on("click",function(i){hsSetSeria(g._data,g.pageKey,jQuery(this).attr("data-pn"));i.preventDefault();g.load()})},send:function(b,f,a,e){var d=this;var c=function(){var g=jQuery.extend({},hsSerialObj(a),hsSerialObj(e||{}));jQuery.hsAjax({url:a,data:e,type:"POST",dataType:"json",funcName:"send",async:false,cache:false,context:d,trigger:b,success:function(h){this.sendBack(b,h,g)}})};if(f){this.warn(f,function(){c()},null)}else{c()}},sendBack:function(b,d,c){d=hsResponObj(d,true);if(d.ok){if(d.msg){this.note(d.msg,"succ")}}else{if(d.msg){this.warn(d.msg,"warn")}else{this.warn(hsGetLang(".error.unkwn"),"warn")}return}var a=jQuery.Event("sendBack");b.trigger(a,[d,c,this]);if(a.isDefaultPrevented()){return}this.load()},open:function(b,d,a,e){var c=this;var f=jQuery.extend({},hsSerialObj(a),hsSerialObj(e||{}));if(d){d.hsOpen(a,e,function(){c.openBack(b,jQuery(this),f)}).data("rel",b.closest(".loadbox").get(0))}else{jQuery.hsOpen(a,e,function(){c.openBack(b,jQuery(this),f)})}},openBack:function(a,c,d){var b=this;a.trigger("openBack",[c,d,this]);c.on("saveBack",function(f,h,e){var g=jQuery.Event("saveBack");g.relatedTarget=f.target;g.relatedHsInst=e;a.trigger(g,[h,d,b]);if(g.isDefaultPrevented()){return}b.load()})},note:function(){jQuery.hsNote.apply(self,arguments)},warn:function(){jQuery.hsWarn.apply(self,arguments)},getRow:function(a){return jQuery(a).closest("tr,.itembox").find(".checkone").filter(":checkbox,:radio,:hidden")},getAll:function(){var a=this.context.find(".checkone").filter(":checked");if(a.length==0){alert(hsGetLang("list.get.all"));return null}else{return a}},getOne:function(){var a=this.context.find(".checkone").filter(":checked");if(a.length!=1){alert(hsGetLang("list.get.one"));return null}else{return a}},_fill__admin:function(d,a,c,b){this.listBox.find('thead [data-fn="'+c+'"],thead [data-ft="'+b+'"]').first().find(".invisible").clone().removeClass("invisible").appendTo(d);d.hsInit().find("input:hidden").val(a);return false},_fill__check:function(c,a,b){jQuery('<input type="checkbox" class="input-checkbox checkone"/>').attr("name",b).val(a).appendTo(c);return false},_fill__radio:function(c,a,b){jQuery('<input type="radio" class="input-radio checkone"/>').attr("name",b).val(a).appendTo(c);return false},_fill__alink:function(c,a,b){jQuery('<a href="javascript:;"></a>').addClass("a-"+b).text(a).appendTo(c);return false},_fill__htime:function(e,a,d){var c=new Date();var b=hsPrsDate(a,hsGetLang("datetime.format"));if(c.getFullYear()==b.getFullYear()&&c.getMonth()==b.getMonth()&&c.getDate()==b.getDate()){return hsGetLang("time.today",[hsFmtDate(a,hsGetLang("time.format"))])}else{return hsFmtDate(a,hsGetLang("date.format"))}},_fill__hdate:function(e,a,d){var c=new Date();var b=hsPrsDate(a,hsGetLang("date.format"));if(c.getFullYear()==b.getFullYear()&&c.getMonth()==b.getMonth()&&c.getDate()==b.getDate()){return hsGetLang("date.today")}else{return hsFmtDate(a,hsGetLang("date.format"))}},_fill__datetime:function(c,a,b){return hsFmtDate(a,hsGetLang("datetime.format"))},_fill__date:function(c,a,b){return hsFmtDate(a,hsGetLang("date.format"))},_fill__time:function(c,a,b){return hsFmtDate(a,hsGetLang("time.format"))},_fill__html:function(c,a,b){c.html(a);return false}};function hsListFillItem(list){var that=this;var cb=this.context.find(".itembox:hidden:first");var tr,td,n,t,f,v;if(!this._keep_prev||!(this._keep_void&&list.length==0)){this.listBox.children().not(cb).remove()}for(var i=0;i<list.length;i++){this._info=list[i];tr=cb.clone();tr.find("[data-fn],[data-ft],[data-fl]").each(function(){td=jQuery(this);n=td.attr("data-fn");t=td.attr("data-ft");f=td.data("fl");v=td.data("fv");if(f&&typeof f!="function"){try{f=eval("(function(list, v, n){return "+f+";})")}catch(e){throw new Error("Parse list data-fl error: "+e)}td.data("fl",f)}if(n){var x=hsGetValue(list[i],n);if(x===undefined){x=list[i][n]}if(x){v=x}}if(f){v=f.call(td,that,v,n)}else{if(n&&that["_fill_"+n]!==undefined){v=that["_fill_"+n].call(that,td,v,n)}else{if(t&&that["_fill_"+t]!==undefined){v=that["_fill_"+t].call(that,td,v,n)}}}if(!v&&v!==0&&v!==""){return}if(td.is("input,select,textarea")){td.val(v)}else{td.text(v)}});tr.show().appendTo(this.listBox)}if(typeof(this._info)!=="undefined"){delete this._info}}function hsListFillNext(f){switch(f.ern){case 1:case"1":jQuery.hsNote(this._above_err||hsGetLang("list.empty"),"erro");return;case 2:case"2":jQuery.hsNote(this._above_err||hsGetLang("list.above"),"erro");return}var b=this.listBox.find("[data-pn]");var g=f.page?parseInt(f.page):1;var a=f.pagecount?parseInt(f.pagecount):1;if(b.size()==0){var e=jQuery('<ul class="pagination"></ul>').appendTo(this.pageBox);e.append(jQuery('<li class="page-prev"><a href="javascript:;" data-pn="">'+hsGetLang("list.prev.page")+"</a></li>"));e.append(jQuery('<li class="page-curr active"><a href="javascript:;"></a></li>'));e.append(jQuery('<li class="page-next"><a href="javascript:;" data-pn="">'+hsGetLang("list.next.page")+"</a></li>"));b=this.listBox.find("[data-pn]")}var c=b.filter(".page-curr a");if(c.size()){c.text(g)}else{c=b.filter(".page-curr");c.text(g)}if(g>1){c=b.filter(".page-prev").removeClass("disabled");c.filter("[data-pn]").attr("data-pn",g-1);c.find("[data-pn]").attr("data-pn",g-1)}else{c=b.filter(".page-prev").addClass("disabled");c.filter("[data-pn]").attr("data-pn",1);c.find("[data-pn]").attr("data-pn",1)}if(g<a){c=b.filter(".page-next").removeClass("disabled");c.filter("[data-pn]").attr("data-pn",g+1);c.find("[data-pn]").attr("data-pn",g+1)}else{c=b.filter(".page-next").addClass("disabled");c.filter("[data-pn]").attr("data-pn",a);c.find("[data-pn]").attr("data-pn",a)}if(!this.listBox.data("inited")){var d=this;this.listBox.on("click","[data-pn]",function(h){hsSetSeria(d._data,d.pageKey,jQuery(this).attr("data-pn"));h.preventDefault();d.load()})}}jQuery.fn.hsList=function(a){return this._hsModule(HsList,a)};(function(a){a(document).on("click",".listbox tbody td",function(b){if(a(b.target).is("a,input,select,textarea")){return}var d=a(this).closest("tr");var c=d.find(".checkone");if(this!=c.closest("td")[0]){d.closest("tbody").find(".checkone").not(c).prop("checked",false)}c.prop("checked",!c.prop("checked")).change()}).on("change",".HsList .checkone",function(){var e=a(this).closest(".HsList");var c=e.find(".checkone").length;var b=e.find(".checkone:checked").length;var d=c&&c===b?true:(b&&b!==c?null:false);e.find(".for-choose").prop("disabled",b!==1);e.find(".for-checks").prop("disabled",b===0);e.find(".checkall").prop("choosed",d)}).on("change",".HsList .checkall",function(){var c=a(this).closest(".HsList");var b=a(this).prop("checked");a(this).prop("choosed",b);c.find(".checkone").prop("checked",b).trigger("change")}).on("loadOver",".HsList .listbox",function(){var b=a(this).closest(".HsList");b.find(".for-choose,.for-checks").prop("disabled",true);b.find(".checkall").prop("choosed",false);b.find(".checkone").change()})})(jQuery);

/**
 * Tree Module
 * @author Hongs
 * @version 15.12.16
 */
function HsTree(i,b){b=jQuery(b);b.data("HsTree",this);b.addClass("HsTree");var j=b.closest(".loadbox");var l=b.find(".treebox");var s=b.find(".findbox");var g=hsGetValue(i,"loadUrl");var c=hsGetValue(i,"sendUrls");var v=hsGetValue(i,"openUrls");var d=hsGetValue(i,"linkUrls");this.idKey=hsGetValue(i,"idKey","id");this.pidKey=hsGetValue(i,"pidKey","pid");this.nameKey=hsGetValue(i,"nameKey","name");this.noteKey=hsGetValue(i,"noteKey");this.typeKey=hsGetValue(i,"typeKey");this.cnumKey=hsGetValue(i,"cnumKey");var a={id:hsGetValue(i,"rootId",hsGetConf("tree.root.id","0")),name:hsGetValue(i,"rootName",hsGetLang("tree.root.name")),note:hsGetValue(i,"rootNote",hsGetLang("tree.root.note")),type:"__ROOT__"};this.context=b;this.loadBox=j;this.treeBox=l;this._url="";this._pid="";if(i){for(var r in i){if("_"===r.substring(0,1)||this[r]!==undefined){this[r]=i[r]}}}if(g){g=hsFixPms(g,j)}var f=this;var q,p,h;function t(x){var B=jQuery(this);var k=x.data[1];var y=x.data[2];var A=B.closest(".tooltip");if(A.length){B=A.data("trigger")}if(typeof(y)==="function"){y.call(f,B,k);return}var w;if(-1!=jQuery.inArray(l[0],B.parents())){w=f.getId(B)}else{w=f.getSid()}if(w==null){return}var z={};z[f.idKey]=w;y=hsFixPms(y,j);f.send(B,k,y,z)}if(c){jQuery.each(c,function(m,k){switch(k.length){case 3:p=k[0];h=k[1];q=k[2];break;case 2:p=k[0];h=k[1];q=undefined;break;default:return}if(typeof(p)==="string"){b.on("click",p,[p,q,h],t)}else{if(p){p.on("click",[p,q,h],t)}}})}function o(x){var A=jQuery(this);var k=x.data[1];var y=x.data[2];switch(k){case"{CONTEXT}":k=b;break;case"{LOADBOX}":k=j;break;case"{AUTOBOX}":k="@";default:if(k){k=A.hsFind(k)}}var z=A.closest(".tooltip");if(z.length){A=z.data("trigger")}if(typeof(y)==="function"){y.call(f,A,k);return}if(0<=y.indexOf("{ID}")){var w;if(0<=jQuery.inArray(l[0],A.parents())){w=f.getId(A)}else{w=f.getSid()}if(w==null){return}y=y.replace("{ID}",encodeURIComponent(w))}y=hsFixPms(y,j);f.open(A,k,y)}if(v){jQuery.each(v,function(m,k){switch(k.length){case 3:p=k[0];h=k[1];q=k[2];break;case 2:p=k[0];h=k[1];q=undefined;break;default:return}if(typeof(p)==="string"){b.on("click",p,[p,q,h],o)}else{if(p){p.on("click",[p,q,h],o)}}})}l.on("click",".tree-node td.tree-hand",function(){f.toggle(jQuery(this).closest(".tree-node"))});l.on("click",".tree-node td:not(.tree-hand)",function(){f.select(jQuery(this).closest(".tree-node"))});if(d){l.on("select",function(k,w){for(var n=0;n<d.length;n++){var m=d[n][1];m=m.replace("{ID}",encodeURIComponent(w));m=hsFixPms(m,j);jQuery(d[n][0]).hsLoad(m)}})}var e=jQuery('<div class="tree-node tree-root" id="tree-node-'+a.id+'"></div>').appendTo(l);this.fillInfo(a,e);this.select(a.id);if(s.length){s.on("submit",function(){f.find(g,this);return true})}if(g){this.load(a.id,g,[])}}HsTree.prototype={load:function(a,b,c){if(a){this._pid=a}if(b){this._url=b}if(c){this._data=hsSerialArr(c)}hsSetSeria(this._data,this.pidKey,this._pid);jQuery.hsAjax({url:this._url,data:this._data,type:"POST",dataType:"json",funcName:"load",async:false,cache:false,context:this,success:function(d){this.loadBack(d,a)}})},loadBack:function(b,a){b=hsResponObj(b);if(b.ok===false){return}this.treeBox.trigger("loadBack",[b,a,this]);if(b.list){this.fillList(b.list,a)}if(this.treeBox.find("#tree-node-"+this.getSid()).size()===0){this.select(a)}this.treeBox.trigger("loadOver",[b,a,this])},fillList:function(g,f){var d,j,c,a;j=this.treeBox.find("#tree-node-"+f);d=j.children(".tree-list:first");if(g.length==0){j.removeClass("tree-fold").removeClass("tree-open");d.remove();return}j.addClass("tree-open");if(d.length==0){d=jQuery('<div class="tree-list"></div>');d.appendTo(j)}var h,b,e={};e[f]=d;for(c=g.length-1;c>-1;c--){a=hsGetValue(g[c],this.idKey);j=this.treeBox.find("#tree-node-"+a);if(j.length==0){j=jQuery('<div class="tree-node"></div>');j.attr("id","tree-node-"+a)}else{j.find("table:first").empty();h=this.getPid(j);b=j.closest(".tree-list");if(h!=f){e[h]=b}}j.prependTo(d);this.fillInfo(g[c],j)}for(c in e){this.fillCnum(g.length,e[c])}},fillInfo:function(d,a){var c=jQuery('<table><tbody><tr><td class="tree-hand"><span class="caret"></span></td><td class="tree-name"></td><td class="tree-cnum"></td></tr></tbody></table>');var e,b;e=hsGetValue(d,this.nameKey);c.find(".tree-name").text(e);if(typeof(this.noteKey)!=="undefined"){e=hsGetValue(d,this.noteKey);a.find(".tree-name").attr("title",e)}if(typeof(this.typeKey)!=="undefined"){b=hsGetValue(d,this.typeKey);a.addClass("tree-type-"+b)}if(typeof(this.cnumKey)!=="undefined"){e=hsGetValue(d,this.cnumKey);c.find(".tree-cnum").text(e);if(e){a.addClass("tree-fold")}}else{a.addClass("tree-fold")}if(!b){b="info"}if(typeof(this["_fill_"+b])!=="undefined"){this["_fill_"+b].call(this,c,d)}c.prependTo(a)},fillCnum:function(d,c){var b=c.closest(".tree-node");var a=c.children(".tree-node");if(typeof(d)==="undefined"){d=a.length}if(d!=a.length){for(var e=a.length-1;e>d-1;e--){jQuery(a[e]).remove()}}if(d!=0){b.find(".tree-cnum").text(d.toString())}else{b.find(".tree-cnum").hide();b.removeClass("tree-fold").removeClass("tree-open")}},find:function(a,b){},findBack:function(a){},send:function(b,f,a,e){var d=this;var c=function(){var g=jQuery.extend({},hsSerialObj(a),hsSerialObj(e||{}));jQuery.hsAjax({url:a,data:e,type:"POST",dataType:"json",funcName:"send",async:false,cache:false,context:d,trigger:b,success:function(h){this.sendBack(b,h,g)}})};if(f){this.warn(f,function(){c()},null)}else{c()}},sendBack:function(b,d,c){d=hsResponObj(d,true);if(d.ok){if(d.msg){this.note(d.msg,"succ")}}else{if(d.msg){this.warn(d.msg,"warn")}else{this.warn(hsGetLang(".error.unkwn"),"warn")}return}var a=jQuery.Event("sendBack");b.trigger(a,[d,c,this]);if(a.isDefaultPrevented()){return}if(c[this.idKey]!==undefined){this.load(this.getPid(c[this.idKey]))}if(c[this.pidKey]!==undefined){this.load(c[this.pidKey])}},open:function(b,d,a,e){var c=this;var f=jQuery.extend({},hsSerialObj(a),hsSerialObj(e||{}));if(d){d.hsOpen(a,e,function(){c.openBack(b,jQuery(this),f)}).data("rel",b.closest(".loadbox").get(0))}else{jQuery.hsOpen(a,e,function(){c.openBack(b,jQuery(this),f)})}},openBack:function(a,c,d){var b=this;a.trigger("openBack",[c,d,this]);c.on("saveBack",function(f,h,e){var g=jQuery.Event("saveBack");g.relatedTarget=f.target;g.relatedHsInst=e;a.trigger(f,[h,d,b]);if(f.isDefaultPrevented()){return}if(d[b.idKey]!==undefined){b.load(b.getPid(d[b.idKey]))}else{b.load(b.getSid())}})},note:function(){jQuery.hsNote.apply(self,arguments)},warn:function(){jQuery.hsWarn.apply(self,arguments)},select:function(b){var a=this.getNode(b);b=this.getId(a);a.children("table").trigger("select",[b,this]);this.treeBox.find(".tree-curr").removeClass("tree-curr");a.addClass("tree-curr")},toggle:function(c){var b=this.getNode(c);c=this.getId(b);b.children("table").trigger("toggle",[c,this]);var a=b.children(".tree-list");a.toggle();if(a.size()){b.removeClass("tree-open").removeClass("tree-fold");a.is(":visible")?b.addClass("tree-open"):b.addClass("tree-fold")}else{this.load(c)}},getId:function(a){if(typeof(a)==="object"){return this.getId(a.attr("id"))}else{if(a){return a.toString().substr(10)}else{return""}}},getPid:function(a){return this.getId(this.getPnode(a))},getSid:function(){return this.getId(this.treeBox.find(".tree-curr"))},getRid:function(){return this.getId(this.treeBox.find(".tree-root"))},getNode:function(a){if(typeof(a)==="object"){return a.closest(".tree-node")}else{return this.treeBox.find("#tree-node-"+a)}},getPnode:function(a){return this.getNode(a).parent().closest(".tree-node")}};jQuery.fn.hsTree=function(a){return this._hsModule(HsTree,a)};(function(a){a(document).on("select",".HsTree .tree-node>table",function(d,f,e){var c=e.context;var b=e.getRid();c.find(".for-select").prop("disabled",b==f)})})(jQuery);

/**
 * Fork Module
 * @author Hongs
 * @version 16.04.29
 */
jQuery.fn.hsPick=function(url,tip,box,fil){if(fil==undefined&&typeof url=="function"){fil=url;url=tip;tip=null}else{if(url==undefined){url=tip;tip=null}}var form=box.closest(".HsForm").data("HsForm")||{};var n=box.attr("name")||box.attr("data-fn");var v={};var vk=box.attr("data-vk")||"id";var tk=box.attr("data-tk")||"name";var mul=/(\[\]|\.\.|\.$)/.test(n);var btn=jQuery(this);if(!fil){do{fil=form["_fill_"+n];if(fil){break}var t;t=box.attr("data-ft");fil=form["_fill_"+t];if(fil){break}t=box.attr("data-fn");fil=form["_fill_"+t];if(fil){break}fil=hsFormFillPick}while(false)}if(box.is("input")){var val=box.val();var txt=btn.text();if(val){v[val]=txt}}else{box.find("li").each(function(){var opt=jQuery(this);var val=opt.find(".pickval").val();var txt=opt.find(".picktxt").text();v[val]=txt})}function pickItem(val,txt){var evt=jQuery.Event("pickItem");box.trigger(evt,arguments);if(evt.isDefaultPrevented()){return false}if(!mul){for(var key in v){delete v[key]}if(txt!==undefined){v[val]=txt}}else{if(txt!==undefined){v[val]=txt}else{delete v[val]}}return true}function pickBack(){if(jQuery.isEmptyObject(v)){var msg=box.data("unpickedError");if(msg!="!"){alert(msg?hsGetLang(msg):hsGetLang("fork.unpicked"));return}}var evt=jQuery.Event("pickBack");box.trigger(evt,[v,tip]);if(evt.isDefaultPrevented()){return false}fil.call(form,box,v,n,"data");box.trigger("change");return true}function pickOpen(){var tip=jQuery(this);tip.data("pickData",v).addClass("pickbox").toggleClass("pickmul",mul).on("change",".checkone",checks).on("click",".ensure",ensure).on("saveBack",".create",create);tip.find(".checkone").val(Object.keys(v))}function checks(){var chk=jQuery(this);if(chk.closest(".HsList").data("HsList")._info){return}if(chk.closest(".openbox").is(tip)==false){return}var val=chk.val();var txt;var inf;do{if(!chk.prop("checked")){break}inf=chk.data();if(!inf){inf=chk.attr("data-data");if(inf){inf=eval("("+inf+")")}else{inf=null}}txt=chk.attr("data-name");if(txt){break}txt=chk.closest("tr").find(".name").text();if(txt){break}var thd=chk.closest("table").find("thead");var tds=chk.closest("tr").find("td");var idx;idx=thd.find("[data-fn='"+tk+"']").index();if(idx!=-1){txt=tds.eq(idx).text()}if(txt){break}idx=thd.find("[data-ft='"+tk+"']").index();if(idx!=-1){txt=tds.eq(idx).text()}if(txt){break}idx=thd.find("[data-ft=name]").index();if(idx!=-1){txt=tds.eq(idx).text()}}while(false);if(pickItem(val,txt,inf)===false){chk.prop("checked",false);return false}}function ensure(){var btn=jQuery(this);if(!btn.closest(".openbox").is(tip)){return}if(!pickBack()){return false}tip.hsClose();return false}function create(evt,rst){var btn=jQuery(this);if(!btn.closest(".openbox").is(tip)){return}if(!rst||!rst.info){return false}if(!pickItem(rst.info[vk],rst.info[tk])){return false}if(!pickBack()){return false}tip.hsClose();return false}if(tip){tip=tip.hsOpen(url,undefined,pickOpen);tip.data("rel",btn.closest(".openbox")[0])}else{tip=jQuery.hsOpen(url,undefined,pickOpen)}return tip};function hsFormFillPick(k,o,c,q){k.data("pickFunc",hsFormFillPick);var a=k.siblings("[data-toggle=hsPick],[data-toggle=hsFork]");var d=/(\[\]|\.\.|\.$)/.test(c);if(q=="info"){var p=k.attr("data-ak")||c.replace(/_id$/,"");o=hsGetValue(this._info,p);if(!o){return}if(!d){o=[o]}}if(jQuery.isArray(o)){var e=k.attr("data-vk")||"id";var s=k.attr("data-tk")||"name";var m={};for(var h=0;h<o.length;h++){var f=o[h];if(f[e]!==undefined&&f[s]!==undefined){m[f[e]]=f[s]}}o=m}else{if(!jQuery.isPlainObject(o)){o={}}}if(k.is("input")){function l(t,n){var i=n.data("txt");var j=n.data("cls");t.val("");n.text(i);n.attr("class",j)}function r(n,j,t,i){n.val(t);j.text(i);j.addClass("btn-success");j.append('<a href="javascript:;" class="close">&times;</a>')}if(!a.data("pickInited")){a.data("pickInited",1);a.data("txt",a.text());a.data("cls",a.attr("class"));a.on("click",".close",k,function(i){var j=jQuery(i.delegateTarget);var n=i.data;l(n,j);n.trigger("change");return false})}if(jQuery.isEmptyObject(o)){l(k,a)}else{for(var b in o){var g=o[b];r(k,a,b,g)}}}else{if(!k.data("pickInited")){k.data("pickInited",1);k.on("click",".close",a,function(i){var n=jQuery(this).closest("li");var t=n.find(":hidden").val();var j=i.data;delete o[t];n.remove();j.show();k.trigger("change");return false});if(!d){k.on("click",null,a,function(i){i.data.click()})}}if(jQuery.isEmptyObject(o)){a.show()}else{if(!d){a.hide()}}k.empty();for(var b in o){var g=o[b];k.append(jQuery('<li class="btn btn-success form-control"></li>').attr("title",g).append(jQuery('<input class="pickval" type="hidden"/>').attr("name",c).val(b)).append(jQuery('<span  class="picktxt"></span>').text(g)).append(jQuery('<span  class="close pull-right">&times;</span>')))}}}function hsListFillPick(b,a,f){var c=b.closest(".pickbox");var e=c.hasClass("pickmul");var d=c.data("pickData")||{};if(!e){c.find(".checkall").hide()}if(!e){HsList.prototype._fill__radio.call(this,b,a,f)}else{HsList.prototype._fill__check.call(this,b,a,f)}if(d[a]!==undefined){b.find(".checkone").prop("checked",true).change()}}(function($){$(document).on("click","[data-toggle=hsPick],[data-toggle=hsFork]",function(){var url=$(this).attr("data-href")||$(this).attr("href");var box=$(this).attr("data-target");if(box){box=$(this)._hsTarget(box)}else{box=null}var inp=$(this).attr("data-fill-area");if(inp){inp=inp.charAt(0)==">"?$(inp,this):$(inp)}else{inp=$(this).siblings("[name],[data-fn]")}var fun=$(this).attr("data-fill-func");if(fun){fun=eval("("+fun+")")}$(this).hsPick(url,box,inp,fun);return false})})(jQuery);jQuery.fn.hsFork=jQuery.fn.hsPick;hsFormFillFork=hsFormFillPick;hsListFillFork=hsListFillPick;hsForkFillForm=hsFormFillPick;hsForkFillList=hsListFillPick;(function(a){a.fn.hsFileVali=function(b){};a.fn.hsFilePick=function(e,f){if(!f){return}e=a(e);var c=f.replace(/^.*[\/\\]/,"");var d=a(this).clone();var b=a(this).parent();var g=a('<li class="btn btn-success form-control"></li>').attr("title",c).append(this).append('<span class="glyphicon glyphicon-file"></span>').append(a('<span  class="picktxt"></span>').text(c)).append('<span class="close pull-right" >&times;</span>');e.append(g);b.append(d);d.val("");return g};a.fn.hsFillFile=function(d,e){if(!e){return}var c=a(this);var b=e.replace(/^.*[\/\\]/,"");var f=a('<li class="btn btn-success form-control"></li>').attr("title",b).append(a('<input class="pickval" type="hidden"/>').attr("name",d).val(e)).append('<span class="glyphicon glyphicon-file"></span>').append(a('<span  class="picktxt"></span>').text(b)).append('<span class="close pull-right" >&times;</span>');c.append(f);return f};a.fn.hsFileLoad=function(b){this.each(function(){var d=this;if(window.FileReader){var c=new FileReader();c.onloadend=function(f){b.call(d,f.target.result)};b.call(d);a.each(this.files,function(f,e){c.readAsDataURL(e)})}else{if(this.getAsDataURL){b.call(d,d.getAsDataURL())}else{b.call(d,d.value)}}});return this};a.fn.hsFileView=function(f,b,j,g,d){if(!b){return}f=a(f);var i=a(this).clone();var l=a(this).parent();var e=d?a.hsKeepView(b,j,g):a.hsPickView(b,j,g);e.css("positoin","absolute");var c=a('<li class="preview"></li>').css({width:j+"px",height:g+"px",overflow:"hidden",position:"relative"}).append(this).append(e).append('<a href="javascript:;" class="close pull-right">&times</a>');f.append(c);l.append(i);i.val("");return c};a.fn.hsFillView=function(g,i,b,e,d){if(!i){return}var f=a(this);var c=d?a.hsKeepView(i,b,e):a.hsPickView(i,b,e);c.css("positoin","absolute");var j=a('<li class="preview"></li>').css({width:b+"px",height:e+"px",overflow:"hidden",position:"relative"}).append(a('<input type="hidden" />').attr("name",g).val(i)).append(c).append('<a href="javascript:;" class="close pull-right">&times</a>');f.append(j);return j};a.hsPickView=function(e,b,d){var c=new Image();c.onload=function(){var h=c.width;var g=c.height;var f=g*b/d;if(f>h){c.width=b;c.height=g*b/h;a(c).css("top",(((d-c.height)/2))+"px")}else{c.height=d;c.width=h*d/g;a(c).css("left",(((b-c.width)/2))+"px")}};c.src=e;return a(c)};a.hsKeepView=function(e,b,d){var c=new Image();c.onload=function(){var h=c.width;var g=c.height;var f=g*b/d;if(f<h){c.width=b;c.height=g*b/h;a(c).css("top",(((d-c.height)/2))+"px")}else{c.height=d;c.width=h*d/g;a(c).css("left",(((b-c.width)/2))+"px")}};c.src=e;return a(c)};a(document).on("click",".forkbox .close,.pickbox .close,.preview .close",function(){a(this).parent().remove()})})(jQuery);
