
if(hsChkUri("public")){window.HsCUID=H$("%HsCUID")}else{window.HsCUID=null;H$("%HsCUID",null)}function S$(){var a=$(".HsList,.HsForm").filter(":visible:first");return a.data("HsList")||a.data("HsForm")}S$.src=function(){return(S$()._url||location.pathname).replace(/\?.*/,"").replace(/\/[^\/]+$/,"")};S$.send=function(b,c){var a;$.hsAjax({url:hsFixUri(b),data:hsSerialArr(c),success:function(d){a=hsResponse(d)},type:"post",dataType:"json",async:false,cache:false,global:false});return a};S$.search=function(b){var a=S$.src()+"/search.act";return S$.send(a,b)};S$.create=function(b){var a=S$.src()+"/create.act";return S$.send(a,b)};S$.update=function(b){var a=S$.src()+"/update.act";return S$.send(a,b)};S$.remove=function(b){var a=S$.src()+"/delete.act";return S$.send(a,b)};S$.browse=function(b){var a=S$();a.load(undefined,hsSerialMix(a._data,b))};function hsListShowEdit(b,a){if(a){if(a.uid!==undefined){a=a.uid}else{if(a.id!==undefined){a=a.id}}}if(a&&a==window.HsCUID){b.show()}}function hsListFillLogo(b,a){if(!a){return}b.css({"background-size":"cover","background-repeat":"no-repeat","background-position":"center center","background-image":"url("+a+")"})}function hsListFillFilt(a,b,c){c=c.replace(/^ar\.\d\./,"");b=this._info[c];return b}function hsListDollFilt(h,j,b){b=b.replace(/^ar\.\d\./,"");j=this._enum[b];var d=h.attr("data-vk")||0;var l=h.attr("data-tk")||1;var c=true;for(var f=0;f<j.length;f++){var e=hsGetValue(j[f],d);if(e==""){c=false;break}}if(c){var g=$.isArray(j)?[]:{};g[d]="";g[l]="";j.unshift(g)}return HsForm.prototype._doll__select.call(this,h,j,b)}var hsListPrepFilt=hsListDollFilt;function hsListInitSort(a,c,f){var d=a;var e=a.next().find("select").eq(0);var b=a.next().find("select").eq(1);b.addClass("invisible");a.next().change(function(){if(e.find("option").first().prop("selected")){b.find("option").first().prop("selected",true);b.toggleClass("invisible",true)}else{b.toggleClass("invisible",false)}d.val(b.val()+e.val())})}function hsListInitMine(a,b,c){a.next().on("change",":radio",function(){switch($(this).val()){case"1":a.attr("name",c+".eq").val(HsCUID);break;case"2":a.attr("name",c+".ne").val(HsCUID);break;default:a.attr("name",c).val("");break}$(this).closest("label").siblings().find("input").prop("checked",false)})}function HsPops(b,e){var d,a,f,c;b=jQuery(b);d=b.closest(".labs");a=false;f="1";c=null;b.hsLoad(e.listUrl+hsSetParam(location.search,"id",null));$(window).on("popstate",function(){a=true;d.children().eq(2).children().hsClose();if(H$("@id")){if(H$("@if")){if(e.formUrl){a=true;d.hsOpen(e.formUrl+location.search)}}else{if(e.infoUrl){a=true;d.hsOpen(e.infoUrl+location.search)}}}else{if(H$("@if")){if(e.addsUrl){a=true;d.hsOpen(e.addsUrl+location.search)}}}});$(window).trigger("popstate");d.on("hsReady",".loadbox",function(){if(a){a=false;return}var i;var g=location.search;var h=hsFixUri($(this).data("href"));if(e.infoUrl&&h.substr(0,e.infoUrl.length)==e.infoUrl){i=hsGetParam(h,"id");g=hsSetParam(g,"id",i);g=hsSetParam(g,"if",c);history.pushState({},"",location.pathname+g)}else{if(e.formUrl&&h.substr(0,e.formUrl.length)==e.formUrl){i=hsGetParam(h,"id");g=hsSetParam(g,"id",i);g=hsSetParam(g,"if",f);history.pushState({},"",location.pathname+g)}else{if(e.addsUrl&&h.substr(0,e.addsUrl.length)==e.addsUrl){g=hsSetParam(g,"id",c);g=hsSetParam(g,"if",f);history.pushState({},"",location.pathname+g)}}}});d.on("hsClose",".loadbox",function(){if(a){a=false;return}var g=location.search;var h=hsFixUri($(this).data("href"));if((e.infoUrl&&h.substr(0,e.infoUrl.length)==e.infoUrl)||(e.formUrl&&h.substr(0,e.formUrl.length)==e.formUrl)||(e.addsUrl&&h.substr(0,e.addsUrl.length)==e.addsUrl)){g=hsSetParam(g,"id",c);g=hsSetParam(g,"if",c);history.pushState({},"",location.pathname+g)}})}function HsCate(b,d){b=$(b);var f=b.find(".statbox");var e=b.find(".findbox");var a=b.find(".toolbox");this.context=b;this.statBox=f;this.findBox=e;this.murl=d.murl;this.curl=d.curl;var c=this;f.data("changed",f.is(".invisible"));a.on("saveBack",function(){if(f.is(".invisible")){f.data("changed",true)}else{f.data("changed",false);setTimeout(function(){c.load()},1000)}});e.on("submit",function(){if(f.is(".invisible")){f.data("changed",true)}else{f.data("changed",false);setTimeout(function(){c.load()},1000)}});f.on("change","input,select",function(){if($(this).is(".checkall2")){$(this).closest(".checkbox").find(".checkone2").prop("checked",false)}else{if($(this).is(".checkone2")){$(this).closest(".checkbox").find(".checkall2").prop("checked",false)}}e.find(":submit").first().click()})}HsCate.prototype={load:function(){this.amount();this.acount()},amount:function(f){var c=this;var a=this.murl;var b=this.context;var e=this.statBox;var d=this.findBox;if(!f){f=[];e.find("[data-type=amount]").each(function(){f.push($(this).attr("data-rb"))})}if(f.length==0){return}$.ajax({url:a+f.join(""),data:d.serialize(),dataType:"json",cache:true,success:function(l){l=l.data||l.info||{};for(var g in l){if(g=="__count__"){continue}var m=e.find("[data-name='"+g+"']");if(0==m.size()){continue}var j=l[g];c.setAmountCheck(m,j)}var i=b.data("HsList");var h=hsSerialDic(i._data);for(var g in h){e.find("[name='"+g+"']").val(h[g])}e.find(".checkbox").each(function(){if($(this).find(":checked").size()===0){e.find(".checkall2").prop("checked",true)}})}})},acount:function(f){var c=this;var a=this.curl;var b=this.context;var e=this.statBox;var d=this.findBox;if(!f){f=[];e.find("[data-type=acount]").each(function(){f.push($(this).attr("data-rb"))})}if(f.length==0){return}$.ajax({url:a+f.join(""),data:d.serialize(),dataType:"json",cache:true,success:function(l){l=l.data||l.info||{};for(var g in l){if(g=="__count__"){continue}var m=e.find("[data-name='"+g+"']");if(0==m.size()){continue}var j=l[g];c.setAcountCheck(m,j)}var i=b.data("HsList");var h=hsSerialDic(i._data);for(var g in h){e.find("[name='"+g+"']").val(h[g])}e.find(".checkbox").each(function(){if($(this).find(":checked").size()===0){e.find(".checkall2").prop("checked",true)}})}})},setAmountCheck:function(e,d){var a=e.data("name");var k=e.data("text");var f=e.empty();if(d.length==0){e.closest(".form-group").hide();return}else{e.closest(".form-group").show()}var h=$("<label></label>");var b=$('<input type="checkbox" class="checkall2"/>');var g=$("<span></span>").text("全部");h.append(b).append(g).appendTo(f);for(var c=0;c<d.length;c++){var j=d[c];if(j[0]==""||j[2]==0){continue}h=$("<label></label>").attr("title",j[1]+" ("+j[2]+")");b=$('<input type="checkbox" class="checkone2"/>').attr("name",a+".rg.").attr("value",j[0]);g=$("<span></span>").text(j[1]);h.append(b).append(g).appendTo(f)}},setAcountCheck:function(e,d){var a=e.data("name");var k=e.data("text");var f=e.empty();if(d.length==0){e.closest(".form-group").hide();return}else{e.closest(".form-group").show()}var h=$("<label></label>");var b=$('<input type="checkbox" class="checkall2"/>');var g=$("<span></span>").text("全部");h.append(b).append(g).appendTo(f);for(var c=0;c<d.length;c++){var j=d[c];if(j[0]==""||j[2]==0){continue}h=$("<label></label>").attr("title",j[1]+" ("+j[2]+")");b=$('<input type="checkbox" class="checkone2"/>').attr("name",a+".in.").attr("value",j[0]);g=$("<span></span>").text(j[1]);h.append(b).append(g).appendTo(f)}}};jQuery.fn.hsCate=function(a){return this._hsModule(HsCate,a)};