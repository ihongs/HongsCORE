
if(hsChkUri("centra")){window.HsCUID=H$("%HsCUID")}else{window.HsCUID=null;H$("%HsCUID",null)}$(window).on("popstate",function(a){a=a.originalEvent;if(!a||!a.state||!a.state.crumb){return}$("#main-context>.breadcrumb>.back-crumb:visible>a").click();history.pushState({crumb:true},null,null)});history.pushState({crumb:true},null,null);$(document).on("reset",".HsList .findbox",function(){var a=$(this);a.find("[data-ft=_fork]").each(function(){hsFormFillFork($(this),{})});setTimeout(function(){a.find(":submit").first().click()},500)});function S$(){var a=$(".HsList,.HsForm").filter(":visible:first");return a.data("HsList")||a.data("HsForm")}S$.src=function(){return(S$()._url||location.pathname).replace(/\?.*/,"").replace(/\/[^\/]+$/,"")};S$.send=function(b,c){var a;$.hsAjax({url:hsFixUri(b),data:hsSerialArr(c),complete:function(d){a=hsResponse(d,3)},type:"post",dataType:"json",async:false,cache:false,global:false});return a};S$.search=function(b){var a=S$.src()+"/search.act";return S$.send(a,b)};S$.create=function(b){var a=S$.src()+"/create.act";return S$.send(a,b)};S$.update=function(b){var a=S$.src()+"/update.act";return S$.send(a,b)};S$.remove=function(b){var a=S$.src()+"/delete.act";return S$.send(a,b)};S$.browse=function(b){var a=S$();a.load(undefined,hsSerialMix(a._data,b))};function hsListFillSele(a,b,c){hsListFillFork.call(this,a,b,c);a.find("input").attr("title",this._info.name).data(this._info)}function hsListFillFilt(a,b,c){c=c.replace(/^ar\.\d\./,"");b=this._info[c];return b}function hsListDollFilt(h,j,b){b=b.replace(/^ar\.\d\./,"");j=this._enum[b];var d=h.attr("data-vk")||0;var l=h.attr("data-tk")||1;var c=true;for(var f=0;f<j.length;f++){var e=hsGetValue(j[f],d);if(e==""){c=false;break}}if(c){var g=$.isArray(j)?[]:{};g[d]="";g[l]="";j.unshift(g)}return HsForm.prototype._doll__select.call(this,h,j,b)}var hsListPrepFilt=hsListDollFilt;function hsListFillOpen(k,m,p){if(!m||!m.length){return}if(!$.isArray(m)){m=[m]}var c;switch(p){case"email":c="glyphicon glyphicon-envelope";break;case"image":c="glyphicon glyphicon-picture";break;case"video":c="glyphicon glyphicon-play";break;case"audio":c="glyphicon glyphicon-play";break;case"file":c="glyphicon glyphicon-file";break;default:c="glyphicon glyphicon-link";break}var j=$('<a><span class="'+c+'"></span></a>');var h=$('<a target="_blank"></a>');var d=$("<li></li>");var o=$("<ul></ul>");for(var g=0;g<m.length;g++){var f,b;if(p==="email"){b="mailto:"+m[g];f=m[g]}else{b=hsFixUri(m[g]);f=m[g].replace(/[?#].*/,"").replace(/.*\//,"");f=decodeURIComponent(f)}o.append(d.clone().append(h.clone().attr("href",b).text(f)))}k.addClass("dont-check");k.data("node",o);if(m.length>1){j.appendTo(k);j.attr("href","javascript:;");j.click(function(){var a=$.hsMask({title:"点击可打开..."});a.find(".modal-body").append(o);a.find(".modal-footer").remove()})}else{j.appendTo(k);j.attr("target","_blank");if(p==="email"){j.attr("href","mailto:"+m[0])}else{j.attr("href",hsFixUri(m[0]))}}}function hsListWrapOpen(a){return function(b,c){hsListFillOpen(b,c,a)}}function hsSaveListCols(d,h){var g=d.is("table")?d:d.find("table:first");var b=g.children("thead").children().children();var a=H$("%list-cols-"+h);if(a){a=a.split(",");for(var c=0;c<a.length;c++){var e=a[c];if(e){b.filter('[data-fn="'+e+'"]').not(".showed").addClass("hidden")}}}d.on("hideCols",function(){a=[];b.filter(".hidden").not(".showed").each(function(){a.push($(this).data("fn"))});a=a.join(",");if(!a){a=null}H$("%list-cols-"+h,a)})}function hsHideListCols(c){var e=c.is("table")?c:c.find("table:first");var a=e.children("thead").children().children();var b=$('<form class="checkbox" onsubmit="return false"></form>');var d=$('<label><input type="checkbox" name="_list_cols" /><span style="display:inline-block"></span></label>');a.each(function(){if($(this).is(".showed,._admin,._check,._fork")){return}var f=d.clone().appendTo(b);f.find("span").text($(this).text());f.find("input").val($(this).data("fn"));f.find("input").prop("checked",!$(this).is(".hidden"))});$.hsMask({title:"请选择要显示的列"},{label:"确定",glass:"btn-primary",click:function(){var f=e.children("thead,tbody,tfoot").children();b.find("input").each(function(){var g=$(this).prop("checked");var h=$(this).val();var i=a.filter('[data-fn="'+h+'"]').index();f.each(function(){$(this).children().eq(i).toggleClass("hidden",!g)})});c.trigger("hideCols")}},{label:"关闭",glass:"btn-default"},{label:"全选",glass:"btn-link pull-left",click:function(f){b.find(":checkbox").prop("checked",true);f.preventDefault();return false}},{label:"全否",glass:"btn-link pull-left",click:function(f){b.find(":checkbox").prop("checked",false);f.preventDefault();return false}}).find(".modal-body").append(b)}function hsCopyListData(h){if(!window.getSelection||!document.createRange||!document.execCommand){$.hsWarn("浏览器无法复制\r\n请使用较新版的 Chrome,Firefox 或以它们为核心的其他浏览器.","warning");return}var b=$("<div></div>").insertBefore(h);var f=$("<table></table>").appendTo(b);var k=$("<thead></thead>").appendTo(f);var l=$("<tbody></tbody>").appendTo(f);var j=$("<tr></tr>");var c=$("<td></th>");var g=$("<td></td>");b.attr("style","height:1px; overflow:auto;");f.attr("class","table table-bordered");h.find("thead:first tr").each(function(){var e=j.clone().appendTo(k);$(this).find("th").each(function(){var n=$(this);if(n.is(".dont-copy,._check,._amenu")){return}var m=c.clone().appendTo(e);m.text(n.text())})});h.find("tbody:first tr.active").each(function(){var e=j.clone().appendTo(l);$(this).find("td").each(function(){var n=$(this);if(n.is(".dont-copy,._check,._amenu")){return}var m=g.clone().appendTo(e);m.attr("style","white-space: pre-line;");if(n.data("node")){m.html(hsTidyHtmlTags(n.data("node")))}else{if(n.data("html")){m.html(hsTidyHtmlTags(n.data("html")))}else{if(n.data("text")){m.text(n.data("text"))}else{if(n.attr("title")){m.text(n.attr("title"))}else{m.html(hsTidyHtmlTags(n.html()))}}}}})});var a=document.createRange();var d=window.getSelection();d.removeAllRanges();try{a.selectNodeContents(f[0]);d.addRange(a)}catch(i){a.selectNode(f[0]);d.addRange(a)}document.execCommand("Copy");b.remove();$.hsNote("复制成功, 去粘贴吧!","success")}function hsTidyHtmlTags(a){if(!a){return""}if(typeof a==="number"){return a+""}if(typeof a==="object"){a=$(a).html()}a=a.replace(/\s+/gm," ");a=a.replace(/<\/?(p|br|hr|ul|ol|li|div|pre)(\/|\s.*?)?>/igm,"\r\n");return $.trim(a)}function hsSaveWithMemo(a){return function(){var c=arguments;var g=c[1];var e=this;var b=jQuery('<input type="text" name="memo" class="form-control" placeholder="选填, 请输入操作备注, 如: 补充简介信息"/>');var f=function(){delete e._waiting};var d=function(){g.append("memo",b.val());HsForm.prototype.save.apply(e,c)};if(a){this.warn(a,"warning",d,f).find(".alert-body").append(b).trigger("shown.bs.modal")}else{d()}}}function hsSendWithMemo(c,g,b,f){var e=this;var a=jQuery('<input type="text" name="memo" class="form-control" placeholder="选填, 请输入操作备注, 如: 清理重复数据"/>');var d=function(){var h=jQuery.extend({},hsSerialDat(f),{memo:a.val()});var i=jQuery.extend({},hsSerialDat(b),hsSerialDat(f));e.ajax({url:b,data:h,type:"POST",dataType:"json",funcName:"send",cache:false,context:e,trigger:c,success:function(j){this.sendBack(c,j,i)}})};if(g){this.warn(g,"warning",d,null).find(".alert-body").append(a).trigger("shown.bs.modal")}else{d()}}function hsFindWithWord(a,b){var c=this.context.find(".findbox [name=wd]").val();if(b&&c&&/^\?.+=/.test(c)){c=hsSerialDic(c);b=hsSerialDic(b);delete b.wd;b=hsSerialMix(b,c)}HsList.prototype.load.call(this,a,b)}function HsStat(b,d){b=$(b);var f=b.find(".statbox");var e=b.find(".findbox");var a=b.find(".toolbox");this.context=b;this.statBox=f;this.findBox=e;this.murl=d.murl;this.curl=d.curl;var c=this;f.data("changed",f.is(".invisible"));a.on("saveBack",function(){if(f.is(".invisible")){f.data("changed",true)}else{f.data("changed",false);setTimeout(function(){c.load()},1000)}});e.on("submit",function(){if(f.is(".invisible")){f.data("changed",true)}else{f.data("changed",false);setTimeout(function(){c.load()},1000)}});f.on("change","input,select",function(){if($(this).is(".checkall2")){$(this).closest(".checkbox").find(".checkone2").prop("checked",false)}else{if($(this).is(".checkone2")){$(this).closest(".checkbox").find(".checkall2").prop("checked",false)}}e.find(":submit").first().click()})}HsStat.prototype={load:function(){var a=this;var b=this.statBox;hsRequires("static/addons/echarts/echarts.min.js",function(){b.find("[data-type=acount],[data-type=amount]").each(function(){var c=$(this);if(!c.data("echart")){var d=c.find(".chartbox");var e=echarts.init(d[0]);c.data("echart",e)}});a.amount();a.acount()})},amount:function(f){var c=this;var a=this.murl;var b=this.context;var e=this.statBox;var d=this.findBox;if(!f){f=[];e.find("[data-type=amount]").each(function(){f.push($(this).attr("data-rb"))})}if(f.length==0){return}$.ajax({url:a+f.join(""),data:d.serialize(),dataType:"json",cache:true,success:function(l){l=l.info||{};for(var g in l){if(g=="__count__"){continue}var m=e.find("[data-name='"+g+"']");if(0==m.size()){continue}var j=l[g];c.setAmountCheck(m,j);c.setAmountChart(m,j)}var i=b.data("HsList");var h=hsSerialDic(i._data);for(var g in h){e.find("[name='"+g+"']").val(h[g])}e.find(".checkbox").each(function(){if($(this).find(":checked").size()===0){$(this).find(".checkall2").prop("checked",true)}})}})},acount:function(f){var c=this;var a=this.curl;var b=this.context;var e=this.statBox;var d=this.findBox;if(!f){f=[];e.find("[data-type=acount]").each(function(){f.push($(this).attr("data-rb"))})}if(f.length==0){return}$.ajax({url:a+f.join(""),data:d.serialize(),dataType:"json",cache:true,success:function(l){l=l.info||{};for(var g in l){if(g=="__count__"){continue}var m=e.find("[data-name='"+g+"']");if(0==m.size()){continue}var j=l[g];c.setAcountCheck(m,j);c.setAcountChart(m,j)}var i=b.data("HsList");var h=hsSerialDic(i._data);for(var g in h){e.find("[name='"+g+"']").val(h[g])}e.find(".checkbox").each(function(){if($(this).find(":checked").size()===0){$(this).find(".checkall2").prop("checked",true)}})}})},report:function(a){var f=this.findBox;var e=a.attr("data-rb");var d=a.attr("data-text");var c=a.attr("data-name");var g=a.attr("data-type");var b=g=="amount"?this.murl:this.curl;b=hsSetParam(b,"rn","0");$.ajax({url:b+e,data:f.serialize(),dataType:"json",cache:true,success:function(x){var k=$("<div></div>").appendTo(a);var n=$("<table></table>").appendTo(k);var v=$("<thead></thead>").appendTo(n);var z=$("<tbody></tbody>").appendTo(n);var u=$("<tr></tr>");var l=$("<td></th>");var o=$("<td></td>");k.attr("style","height:1px; overflow:auto;");n.attr("class","table table-bordered");var q=u.clone().appendTo(v);l.clone().appendTo(q).text(d);l.clone().appendTo(q).text("数量");if(g==="amount"){l.clone().appendTo(q).text("求和");l.clone().appendTo(q).text("最小");l.clone().appendTo(q).text("最大")}if(x.info&&x.info[c]){var y=x.info[c];for(var r=0;r<y.length;r++){var w=y[r];q=u.clone().appendTo(z);for(var p=1;p<w.length;p++){var t=w[p];o.clone().appendTo(q).text(t)}}}var h=document.createRange();var m=window.getSelection();m.removeAllRanges();try{h.selectNodeContents(n[0]);m.addRange(h)}catch(s){h.selectNode(n[0]);m.addRange(h)}document.execCommand("Copy");k.remove();$.hsNote("复制成功, 去粘贴吧!","success")}})},setAmountCheck:function(e,d){var a=e.data("name");var k=e.data("text");var f=e.find(".checkbox").empty();var h=$("<label></label>");var b=$('<input type="checkbox" class="checkall2"/>');var g=$("<span></span>").text("全部"+k);h.append(b).append(g).appendTo(f);for(var c=0;c<d.length;c++){var j=d[c];if(j[0]==""||j[2]==0){continue}h=$("<label></label>").attr("title",j[1]+" ("+j[2]+", "+j[3]+")");b=$('<input type="checkbox" class="checkone2"/>').attr("name",a+".rg.").attr("value",j[0]);g=$("<span></span>").text(j[1]);h.append(b).append(g).appendTo(f)}},setAcountCheck:function(e,d){var a=e.data("name");var k=e.data("text");var f=e.find(".checkbox").empty();var h=$("<label></label>");var b=$('<input type="checkbox" class="checkall2"/>');var g=$("<span></span>").text("全部"+k);h.append(b).append(g).appendTo(f);for(var c=0;c<d.length;c++){var j=d[c];if(j[0]==""||j[2]==0){continue}h=$("<label></label>").attr("title",j[1]+" ("+j[2]+")");b=$('<input type="checkbox" class="checkone2"/>').attr("name",a+".in.").attr("value",j[0]);g=$("<span></span>").text(j[1]);h.append(b).append(g).appendTo(f)}},setAcountChart:function(h,f){var k=this;var l=h.data("echart");var e=[];var c=[];var b=[];for(var g=0;g<f.length;g++){var m=f[g];if(m[0]==""||m[2]==0){continue}e.push(m[1]);c.push(m[2]);b.push({value:m[2],name:m[1]})}var j={series:[{data:b,type:"pie"}],xAxis:[{show:false}],yAxis:[{show:false}]};var d={series:[{data:c,type:"bar",barMaxWidth:13,itemStyle:{normal:{barBorderRadius:[4,4,0,0]}}}],xAxis:[{data:e,show:true,type:"category"}],yAxis:[{show:true,type:"value"}]};var a={grid:{top:30,left:15,right:15,bottom:0,containLabel:true},tooltip:{},toolbox:{show:true,feature:{show:true,myBar:{show:true,icon:"M85.312 938.688H1024V1024H0V0h85.312v938.688zM256 341.312h85.312V768H256V341.312zM512 128h85.312v640H512V128z m256 213.312h85.312V768H768V341.312z",iconStyle:{borderWidth:0,color:"#666"},title:"柱状图",onclick:function(){l.setOption(d)}},myPie:{show:true,icon:"M85.312 512a426.688 426.688 0 0 0 844.8 85.312H426.688V93.888A426.816 426.816 0 0 0 85.312 512zM512 0v512h512a512 512 0 1 1-512-512z m506.816 438.848H585.152V5.184a512.32 512.32 0 0 1 433.664 433.664z",iconStyle:{borderWidth:0,color:"#666"},title:"饼视图",onclick:function(){l.setOption(j)}},myTab:{show:true,icon:"M512 1024A512 512 0 1 1 512 0a512 512 0 0 1 0 1024z m0-85.312A426.688 426.688 0 1 0 512 85.312a426.688 426.688 0 0 0 0 853.376zM320 576a64 64 0 1 1 0-128 64 64 0 0 1 0 128z m192 0a64 64 0 1 1 0-128 64 64 0 0 1 0 128z m192 0a64 64 0 1 1 0-128 64 64 0 0 1 0 128z",iconStyle:{borderWidth:0,color:"#666"},title:"导出",onclick:function(){k.report(h)}}}}};if(h.data("plot")=="pie"){$.extend(a,j)}else{$.extend(a,d)}l.resize();l.setOption(a)},setAmountChart:function(j,h){var m=this;var n=j.data("echart");var e=[];var c=[];var b=[];var k=[];var g=[];for(var f=0;f<h.length;f++){var o=h[f];if(o[0]==""||o[2]==0){continue}e.push(o[1]);c.push(o[2]);b.push(o[3]);k.push({value:o[2],name:o[1]});g.push({value:o[3],name:o[1]})}var l={series:[{radius:[0,50],data:k,type:"pie"},{radius:[60,80],data:g,type:"pie"}],xAxis:[{show:false}],yAxis:[{show:false}]};var d={series:[{data:c,type:"bar",barMaxWidth:13,itemStyle:{normal:{barBorderRadius:[4,4,0,0]}}},{data:b,type:"bar",barMaxWidth:13,itemStyle:{normal:{barBorderRadius:[4,4,0,0]}}}],xAxis:[{data:e,show:true,type:"category"}],yAxis:[{show:true,type:"value"},{show:true,type:"value",position:"right"}]};var a={grid:{top:30,left:15,right:15,bottom:0,containLabel:true},tooltip:{},toolbox:{show:true,feature:{show:true,myBar:{show:true,icon:"M85.312 938.688H1024V1024H0V0h85.312v938.688zM256 341.312h85.312V768H256V341.312zM512 128h85.312v640H512V128z m256 213.312h85.312V768H768V341.312z",iconStyle:{borderWidth:0,color:"#666"},title:"柱状图",onclick:function(){n.setOption(d)}},myPie:{show:true,icon:"M85.312 512a426.688 426.688 0 0 0 844.8 85.312H426.688V93.888A426.816 426.816 0 0 0 85.312 512zM512 0v512h512a512 512 0 1 1-512-512z m506.816 438.848H585.152V5.184a512.32 512.32 0 0 1 433.664 433.664z",iconStyle:{borderWidth:0,color:"#666"},title:"饼视图",onclick:function(){n.setOption(l)}},myTab:{show:true,icon:"M512 1024A512 512 0 1 1 512 0a512 512 0 0 1 0 1024z m0-85.312A426.688 426.688 0 1 0 512 85.312a426.688 426.688 0 0 0 0 853.376zM320 576a64 64 0 1 1 0-128 64 64 0 0 1 0 128z m192 0a64 64 0 1 1 0-128 64 64 0 0 1 0 128z m192 0a64 64 0 1 1 0-128 64 64 0 0 1 0 128z",iconStyle:{borderWidth:0,color:"#666"},title:"导出",onclick:function(){m.report(j)}}}}};if(j.data("plot")=="pie"){$.extend(a,l)}else{$.extend(a,d)}n.resize();n.setOption(a)}};jQuery.fn.hsStat=function(a){return this._hsModule(HsStat,a)};