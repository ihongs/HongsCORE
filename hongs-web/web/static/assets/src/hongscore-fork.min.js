jQuery.fn.hsPick=function(d,m,i,s,e){var k={};var p=i.attr("data-fn")||i.attr("name");var l=i.attr("data-ft")||i.attr("type");var u=i.attr("data-vk")||"id";var c=i.attr("data-tk")||"name";var q=i.is(".pickmul")||!!i.data("repeated")||!!i.data("multiple")||/(\[\]|\.\.|\.$)/.test(p);var r=i.closest(".HsForm").data("HsForm")||{};var f=jQuery(this);if(!s){do{s=r["_fill_"+p];if(s){break}s=r["_fill_"+l];if(s){break}s=hsFormFillPick}while(false)}if(!e){do{e=r["_fork_"+p];if(e){break}e=r["_fork_"+l];if(e){break}e=hsFormForkData}while(false)}e.call(r,i,k,p);function h(y,n,x,v){var t=jQuery.Event("pickItem");t.target=v;i.trigger(t,arguments);if(t.isDefaultPrevented()){return false}if(!q){for(var w in k){delete k[w]}if(n!==undefined){k[y]=[n,x]}}else{if(n!==undefined){k[y]=[n,x]}else{delete k[y]}}return true}function b(){if(jQuery.isEmptyObject(k)){var t=i.data("unpickedError");if(t!="!"){t=t?t:"fork.unpicked";if(!confirm(hsGetLang(t))){return}}}var n=jQuery.Event("pickBack");n.target=m;i.trigger(n,[k,p,l]);if(n.isDefaultPrevented()){return false}s.call(r,i,k,p);i.trigger("change");return true}function a(){var n=jQuery.Event("pickOpen");n.target=m;i.trigger(n,[k,p,l]);m.addClass("pickbox").toggleClass("pickmul",q).on("change",".checkone",o).on("click",".commit",g).on("saveBack",".create",j);var v=Object.keys(k);var t=v.length||"";m.data("pickData",k);m.find(".checkone").val(v);m.find(".picknum").text(t)}function o(){var v=jQuery(this);if(v.closest(".HsList").data("HsList")._info){return}if(v.closest(".openbox").is(m)!==true){return}var A=v.val();var t;var y;do{if(!v.prop("checked")){break}t=v.attr("title");if(t){break}var z=v.closest("table").find("thead");var x=v.closest("tr").find("td");var n;n=z.find("[data-fn='"+c+"']").index();if(n!=-1){t=x.eq(n).text()}if(t){break}n=z.find("[data-ft='"+c+"']").index();if(n!=-1){t=x.eq(n).text()}if(t){break}n=z.find(".name").index();if(n!=-1){t=x.eq(n).text()}}while(false);if(t){y=v.hsData()}if(h(A,t,y,v)===false){v.prop("checked",false);return false}var w=Object.keys(k).length;m.find(".picknum").text(w||"")}function g(){var n=jQuery(this);if(n.closest(".HsList").data("HsList")._info){return}if(n.closest(".openbox").is(m)!==true){return}if(b()===false){return false}m.hsClose();return false}function j(){var w=jQuery(this);if(w.closest(".HsList").data("HsList")._info){return}if(w.closest(".openbox").is(m)!==true){return}var t=i.attr("data-at");var v=arguments[0];var y=arguments[1];if(y.list){y=y.list[0]}else{if(y.info){y=y.info}else{if(y.nid&&t){$.hsAjax({url:hsSetParam(t,u,y.nid),cache:false,rsync:false,dataType:"json",complete:function(z){z=hsResponse(z);delete z.nid;j.call(w[0],v,z)}});return false}else{return}}}var x=y[u]||hsGetValue(y,u);var n=y[c]||hsGetValue(y,c);if(h(x,n,y)===false){return false}if(b()===false){return false}m.hsClose();return false}if(m){m=m.hsOpen(d,a)}else{m=jQuery.hsOpen(d,a)}m.data("rel",f.closest(".openbox")[0]);return m};function hsFormForkData(c,b){if(c.is("input")){var e=c.val();var d=c.data();var a=c.attr("title")||c.data("name");if(e){b[e]=[a,d||{}]}}else{if(c.is("ul,ol")){c.find("li").each(function(){var j=jQuery(this);var g=j.find("input");var i=g.val();var h=g.data();var f=j.attr("title")||g.data("name");if(i){b[i]=[f,h||{}]}})}else{if(c.is("table,tbody")){c.find("tr").each(function(){var j=jQuery(this);var g=j.find("input");var i=g.val();var h=g.data();var f=j.attr("title")||g.data("name");if(i){b[i]=[f,h||{}]}})}else{c.find("input:hidden").each(function(){var g=jQuery(this);var i=g.val();var h=g.data();var f=g.attr("title")||g.data("name");if(i){b[i]=[f,h||{}]}})}}}}function hsFormFillPick(h,k,o){if(!o){o=h.data("fn")}var m=h.is(".pickrol")||!!h.data("readonly");var u=h.is(".pickmul")||!!h.data("repeated")||!!h.data("multiple")||/(\[\]|\.\.|\.$)/.test(o);var f=h.siblings("[data-toggle=hsPick],[data-toggle=hsFork]");h.toggleClass("pickmul",u);if(this._info){var q=h.attr("data-ak")||"data";k=this._info[q]||hsGetValue(this._info,q);if(!k){return}if(!u){k=[k]}}if(jQuery.isArray(k)){var e=h.attr("data-tk")||"name";var w=h.attr("data-vk")||"id";var d={};for(var s=0;s<k.length;s++){var r=k[s];if(!jQuery.isPlainObject(r)&&!jQuery.isArray(r)){continue}var c=r[w]||hsGetValue(r,w);var g=r[e]||hsGetValue(r,e);if(c!==undefined&&g!==undefined){d[c]=[g,r]}}k=d}else{if(!jQuery.isPlainObject(k)){k={}}}function x(n,v){var i=n.data("txt");var j=n.data("cls");n.text(i);v.val("");v.attr("title","");n.attr("class",j)}function p(j,n,v,i){j.text(i);n.val(v);n.attr("title",i);j.addClass("btn-info");j.append('<span class="close pull-right">&times;</span>')}function t(z,A,i,j){var n=jQuery("<span></span>").text(i);var v=jQuery('<input type="hidden" />').attr("name",o).val(A);var B=jQuery('<li class="btn '+j[0]+' form-control"></li>').attr("title",i).append('<span class="close pull-right">&times;</span>').append('<span class="glyphicon '+j[1]+'" ></span>').append(n).append(v);z.append(B)}if(h.is("input")){if(!f.data("pickInited")){f.data("pickInited",1);f.data("txt",f.text());f.data("cls",f.attr("class"));f.on("click",".close",[f,h],function(i){var j=i.data[0];var n=i.data[1];var v=n.val();delete k[v];x(n,j);n.trigger("change");return false})}if(!jQuery.isEmptyObject(k)){for(var y in k){var a=k[y];var l=a[0];p(f,h,y,l)}}else{x(f,h)}}else{if(!h.data("pickInited")){h.data("pickInited",1);h.on("click",".close",[f,h],function(i){var n=i.data[0];var v=i.data[1];var j=jQuery(this).closest("li");var z=j.find("input:hidden").val();delete k[z];j.remove();n.show();v.trigger("change");return false});h.on("click","li.btn",[f,h],function(j){var A=j.data[0];var B=j.data[1];var z=jQuery(this).closest("li");var C=z.find("input:hidden").val();var v=B.attr("data-vk")||("id");var n=B.attr("data-href");var i=B.attr("data-target");if(n==="-"||i==="-"||j.isDefaultPrevented()){return}if(n){n=hsSetParam(n,v,C);if(!i){jQuery.hsOpen(n)}else{B.hsFind(i).hsOpen(n)}}else{if(!m&&!u){A.click()}}})}if(!jQuery.isEmptyObject(k)){if(!u){f.hide()}}else{if(!m){f.show()}}var b=[];if(h.attr("data-href")){b[0]=m?"btn-link":"btn-info";b[1]=m?"glyphicon-link":"glyphicon-share"}else{b[0]=m?"btn-text":"btn-info";b[1]=m?"glyphicon-link":"glyphicon-check"}b[0]=h.attr("data-item-class")||b[0];b[1]=h.attr("data-icon-class")||b[1];h.empty();for(var y in k){var a=k[y];var l=a[0];t(h,y,l,b)}}}function hsListFillPick(b,a,f){var c=b.closest(".pickbox,.openbox,.loadbox");var d=c.hasClass("pickmul");var e=c.data("pickData")||{};if(!d){c.find(".checkall").hide()}if(!d){HsList.prototype._fill__radio.call(this,b,a,f)}else{HsList.prototype._fill__check.call(this,b,a,f)}if(e[a]!==undefined){b.find(".checkone").prop("checked",true).change()}b.find(".checkone").data(this._info)}(function(a){a(document).on("click","[data-toggle=hsPick],[data-toggle=hsFork]",function(){var b=a(this).attr("data-href")||a(this).attr("href");var c=a(this).attr("data-target");var d=a(this).attr("data-result");if(c){c=a(this).hsFind(c)}if(d){d=a(this).hsFind(d)}else{d=a(this).siblings("[name],[data-fn],[data-ft]").not(".form-ignored")}a(this).hsPick(b,c,d);return false})})(jQuery);jQuery.fn.hsFork=jQuery.fn.hsPick;hsFormFillFork=hsFormFillPick;hsListFillFork=hsListFillPick;