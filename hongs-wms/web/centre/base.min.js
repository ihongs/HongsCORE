if(hsChkUri("public")){window.HsCUID=H$("%HsCUID");window.HsCUST=H$("%HsCUST")}else{window.HsCUID=null;window.HsCUST=null;H$("%HsCUID",null);H$("%HsCUST",null)}$(document).on("reset",".HsList .findbox",function(){var a=$(this);a.find("[data-ft=_fork]").each(function(){hsFormFillFork($(this),{})});setTimeout(function(){a.find(":submit").first().click()},500)});function hsListShowEdit(b,a){if(a){if(a.uid!==undefined){a=a.uid}else{if(a.id!==undefined){a=a.id}}}if(a&&a==window.HsCUID){b.show()}}function hsListFillLogo(b,a){if(!a){return}b.css({"background-size":"cover","background-repeat":"no-repeat","background-position":"center center","background-image":"url("+a+")"})}function hsListFillFilt(a,b,c){c=c.replace(/^ar\.\d\./,"");b=this._info[c];return b}function hsListDollFilt(h,j,b){b=b.replace(/^ar\.\d\./,"");j=this._enum[b];var d=h.attr("data-vk")||0;var l=h.attr("data-tk")||1;var c=true;for(var f=0;f<j.length;f++){var e=hsGetValue(j[f],d);if(e==""){c=false;break}}if(c){var g=$.isArray(j)?[]:{};g[d]="";g[l]="";j.unshift(g)}return HsForm.prototype._doll__select.call(this,h,j,b)}var hsListPrepFilt=hsListDollFilt;function hsListInitSort(a,c,f){var d=a;var e=a.next().find("select").eq(0);var b=a.next().find("select").eq(1);b.addClass("invisible");a.next().change(function(){if(e.find("option").first().prop("selected")){b.find("option").first().prop("selected",true);b.toggleClass("invisible",true)}else{b.toggleClass("invisible",false)}d.val(b.val()+e.val())})}function hsListInitMine(a,b,c){a.next().on("change",":radio",function(){switch($(this).val()){case"1":a.attr("name",c+".eq").val(HsCUID);break;case"2":a.attr("name",c+".ne").val(HsCUID);break;default:a.attr("name",c).val("");break}$(this).closest("label").siblings().find("input").prop("checked",false)})}function HsPops(b,e){var d,a,f,c;b=jQuery(b);d=b.children(".labs");if(d.size()===0){d=b.closest(".labs")}a=false;f="1";c=null;$(window).on("popstate",function(){a=true;d.children().eq(2).children().hsClose();if(hsGetParam(location.search,"id")){if(hsGetParam(location.search,"if")){if(e.formUrl){a=true;d.hsOpen(e.formUrl+location.search)}}else{if(e.infoUrl){a=true;d.hsOpen(e.infoUrl+location.search)}}}else{if(hsGetParam(location.search,"if")){if(e.addsUrl){a=true;d.hsOpen(e.addsUrl+location.search)}}}});$(window).trigger("popstate");d.on("hsReady",".loadbox",function(){if(a){a=false;return}var i;var g=location.search;var h=hsFixUri($(this).data("href"));if(e.infoUrl&&h.substr(0,e.infoUrl.length)==e.infoUrl){i=hsGetParam(h,"id");g=hsSetParam(g,"id",i);g=hsSetParam(g,"if",c);history.pushState({},"",location.pathname+g)}else{if(e.formUrl&&h.substr(0,e.formUrl.length)==e.formUrl){i=hsGetParam(h,"id");g=hsSetParam(g,"id",i);g=hsSetParam(g,"if",f);history.pushState({},"",location.pathname+g)}else{if(e.addsUrl&&h.substr(0,e.addsUrl.length)==e.addsUrl){g=hsSetParam(g,"id",c);g=hsSetParam(g,"if",f);history.pushState({},"",location.pathname+g)}}}});d.on("hsClose",".loadbox",function(){if(a){a=false;return}var g=location.search;var h=hsFixUri($(this).data("href"));if((e.infoUrl&&h.substr(0,e.infoUrl.length)==e.infoUrl)||(e.formUrl&&h.substr(0,e.formUrl.length)==e.formUrl)||(e.addsUrl&&h.substr(0,e.addsUrl.length)==e.addsUrl)){g=hsSetParam(g,"id",c);g=hsSetParam(g,"if",c);history.pushState({},"",location.pathname+g)}})}function HsCate(b,d){b=$(b);var f=b.find(".statbox");var e=b.find(".findbox");var a=b.find(".toolbox");this.context=b;this.statBox=f;this.findBox=e;this.murl=d.murl;this.curl=d.curl;this.eurl=d.eurl;var c=this;f.data("changed",f.is(".invisible"));a.on("saveBack",function(){if(f.is(".invisible")){f.data("changed",true)}else{f.data("changed",false);setTimeout(function(){c.load()},1000)}});e.on("submit",function(){if(f.is(".invisible")){f.data("changed",true)}else{f.data("changed",false);setTimeout(function(){c.load()},1000)}});f.on("change","input,select",function(){if($(this).is(".checkall2")){$(this).closest(".checkbox").find(".checkone2").prop("checked",false)}else{if($(this).is(".checkone2")){$(this).closest(".checkbox").find(".checkall2").prop("checked",false)}}e.find(":submit").first().click()})}HsCate.prototype={load:function(){var a=this;var b=this.statBox;a.fill(b.find("[data-type=ecount]"));a.fill(b.find("[data-type=acount]"));a.fill(b.find("[data-type=amount]"))},fill:function(i){if(0===i.size()){return}var f=this;var c=this.context;var j=this.statBox;var d=this.findBox;var b=[];var g=[];var e=i.attr("data-type");var a=e==="amount"?this.murl:(e==="acount"?this.curl:this.eurl);i.each(function(){if($(this).data("name")){b.push($(this).data("name"))}if($(this).data("extr")){g.push($(this).data("extr"))}$(this).empty()});a=hsSetParam(a,"rb.",b)+g.join("&");var k;var h;do{h=c.data("HsList");if(h){k=h._data;break}h=c.data("HsTree");if(h){k=h._data;break}k=hsSerialDic(d)}while(false);$.hsAjax({url:a,data:k,dataType:"json",cache:true,success:function(o){o=o.info||{};for(var l in o){var m=o[l];var p=j.find("[data-name='"+l+"']");if(p.size()===0){continue}if(m.length===0){continue}if(e==="amount"){f.setAmountCheck(p,m)}else{f.setAcountCheck(p,m)}l=p.find(".checkone2").attr("name");if(k&&k[l]){p.find(".checkone2").val(k[l])}else{p.find(".checkall2").prop("checked",true)}}i.filter(":empty").closest(".stat-group").hide()}})},setAmountCheck:function(e,d){var a=e.data("name");var k=e.data("text");var f=e.empty();if(d.length==0){e.closest(".form-group").hide();return}else{e.closest(".form-group").show()}var h=$("<label></label>");var b=$('<input type="checkbox" class="checkall2"/>');var g=$("<span></span>").text("全部");h.append(b).append(g).appendTo(f);for(var c=0;c<d.length;c++){var j=d[c];if(j[0]==""||j[2]==0){continue}h=$("<label></label>").attr("title",j[1]+" ("+j[2]+")");b=$('<input type="checkbox" class="checkone2"/>').attr("name",a+".rg.").attr("value",j[0]);g=$("<span></span>").text(j[1]);h.append(b).append(g).appendTo(f)}},setAcountCheck:function(e,d){var a=e.data("name");var k=e.data("text");var f=e.empty();if(d.length==0){e.closest(".form-group").hide();return}else{e.closest(".form-group").show()}var h=$("<label></label>");var b=$('<input type="checkbox" class="checkall2"/>');var g=$("<span></span>").text("全部");h.append(b).append(g).appendTo(f);for(var c=0;c<d.length;c++){var j=d[c];if(j[0]==""||j[2]==0){continue}h=$("<label></label>").attr("title",j[1]+" ("+j[2]+")");b=$('<input type="checkbox" class="checkone2"/>').attr("name",a+".in.").attr("value",j[0]);g=$("<span></span>").text(j[1]);h.append(b).append(g).appendTo(f)}}};jQuery.fn.hsCate=function(a){return this._hsModule(HsCate,a)};