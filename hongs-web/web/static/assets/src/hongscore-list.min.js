function HsList(b,a){b=jQuery(b);var q=b.closest(".loadbox");var c=b.find(".listbox");var p=b.find(".pagebox");var l=b.find(".findbox");var j=hsGetValue(a,"loadUrl");var g=hsGetValue(a,"sendUrls");var f=hsGetValue(a,"openUrls");var e=hsGetValue(a,"loadData");this.sortKey=hsGetValue(a,"sortKey",hsGetConf("ob.key","ob"));this.pageKey=hsGetValue(a,"pageKey",hsGetConf("pn.key","pn"));this.pugsKey=hsGetValue(a,"pugsKey",hsGetConf("gn.key","gn"));this.rowsKey=hsGetValue(a,"rowsKey",hsGetConf("rn.key","rn"));this.pugsNum=hsGetValue(a,"pugsNum",hsGetConf("pugs.for.page",5));this.rowsNum=hsGetValue(a,"rowsNum",hsGetConf("rows.per.page",20));this.context=b;this.loadBox=q;this.listBox=c;this.pageBox=p;this._url="";this._data=[];if(a){for(var i in a){if("_"===i.substring(0,1)||this[i]!==undefined){this[i]=a[i]}}}var o=this;var h,d,t;function s(v){var z=jQuery(this);var k=v.data[1];var w=v.data[2];var x=z.closest(".tooltip");if(x.length){z=x.data("trigger")}if(typeof(w)==="function"){w.call(o,z,k);return}var y=o.getIds(z);if(y==null){return}w=hsFixPms(w,q);o.send(z,k,w,y)}if(g){jQuery.each(g,function(m,k){switch(k.length){case 3:t=k[0];d=k[1];h=k[2];break;case 2:t=k[0];d=k[1];h=undefined;break;default:return}if(typeof(d)!=="string"||/^[@%\^\-+~>*#]/.test(d)){b.hsFind(d).on("click",[d,h,t],s)}else{b.on("click",d,[d,h,t],s)}})}function r(v){var z=jQuery(this);var k=v.data[1];var w=v.data[2];var x=z.closest(".tooltip");if(x.length){z=x.data("trigger")}if(typeof(w)==="function"){w.call(o,z,k);return}var y=o.getIds(z);if(y==null){return}w=hsFixPms(w,q);o.open(z,k,w,y)}if(f){jQuery.each(f,function(m,k){switch(k.length){case 3:t=k[0];d=k[1];h=k[2];break;case 2:t=k[0];d=k[1];h=undefined;break;default:return}if(typeof(d)!=="string"||/^[@%\^\-+~>*#]/.test(d)){b.hsFind(d).on("click",[d,h,t],r)}else{b.on("click",d,[d,h,t],r)}})}if(l.length){l.on("submit",function(){o.load(null,hsSerialMix(e,l));return false})}if(j){this.load(hsFixPms(j,q),hsSerialMix(e,l))}}HsList.prototype={load:function(a,b){b=hsSerialObj(b);if(a){this._url=a}if(b){this._data=b}this.ajax({url:this._url,data:this._data,type:"POST",dataType:"json",funcName:"load",cache:false,global:false,context:this,complete:this.loadBack})},loadBack:function(c){c=hsResponse(c);if(c.ok===false){return}this.listBox.trigger("loadBack",[c,this]);var b=c.list||[];var a=c.page||{};if(!c.page){if(!c.list||!c.list.length){a={state:1}}else{a={state:-1}}}this.fillList(b);this.fillPage(a);this.listBox.trigger("loadOver",[c,this])},fillList:function(list){var ths,th,tb,tr,td,i,j,n,t,v,f;ths=this.listBox.find("thead th,thead td");tb=this.listBox.find("tbody");tb.empty();var sn=hsGetSeria(this._data,this.sortKey);if(!sn){sn=hsGetParam(this._url,this.sortKey)}if(jQuery.isArray(sn)){sn=sn.join(",")}for(i=0;i<ths.length;i++){th=jQuery(ths[i]);f=th.data("fl");if(f&&typeof f!="function"){try{f=eval("(null||function(list,v,n){return "+f+";})")}catch(e){throw new Error("Parse list data-fl error: "+e)}th.data("fl",f)}if(th.hasClass("sortable")){var fn=th.attr("data-ob")||th.attr("data-fn");this._fill__sort(th,sn,fn)}}this._list=list;for(i=0;i<list.length;i++){this._info=list[i];tr=jQuery("<tr></tr>").appendTo(tb);for(j=0;j<ths.length;j++){th=jQuery(ths[j]);td=jQuery("<td></td>").appendTo(tr);td.attr("class",th.attr("class"));n=th.data("fn");t=th.data("ft");f=th.data("fl");if(n!==undefined){v=hsGetValue(list[i],n);if(v===undefined){v=list[i][n]}}else{v=undefined}if(f){v=f.call(td[0],this,v,n)}if(n&&this["_fill_"+n]!==undefined){v=this["_fill_"+n].call(this,td,v,n)}else{if(t&&this["_fill_"+t]!==undefined){v=this["_fill_"+t].call(this,td,v,n)}}if(!v&&v!==0&&v!==""){continue}if(jQuery.isArray(v)){v=v.join(", ")}td.text(v)}}delete this._list;if(typeof(this._info)!=="undefined"){delete this._info}},fillPage:function(k){if(k[this._ps_key]!="0"){this.pageBox.empty();this.listBox.show()}else{if(k[this._rc_key]=="0"||k[this._pc_key]=="0"){this.pageBox.empty().append('<div class="alert alert-warning" style="width: 100%;">'+(this._empty_err||hsGetLang("list.empty"))+"</div>");this.listBox.hide();return}else{this.pageBox.empty().append('<div class="alert alert-warning" style="width: 100%;">'+(this._above_err||hsGetLang("list.above"))+"</div>");this.listBox.hide();var j=this;hsSetSeria(this._data,this.pageKey);setTimeout(function(){j.load()},5000);return}}var g,a,b,o,c,h,j=this;a=k[this.rowsKey]?parseInt(k[this.rowsKey]):this.rowsNum;b=k[this.pageKey]?parseInt(k[this.pageKey]):1;o=k[this._pc_key]?parseInt(k[this._pc_key]):1;c=b-Math.floor(this.pugsNum/2);if(c<1){c=1}h=c+this.pugsNum-1;if(h>o){h=o}c=h-this.pugsNum+1;if(c<1){c=1}var d=jQuery('<ul class="pagination pull-left"></ul>').appendTo(this.pageBox);var q=jQuery('<em class="page-text pull-right"></em>').appendTo(this.pageBox);var m=d;var f=d;if(k[this._ps_key]=="2"){q.text(hsGetLang("list.page.unfo",k))}else{q.text(hsGetLang("list.page.info",k))}q.append(jQuery('<a href="javascript:;" class="glyphicon glyphicon-bookmark"></a>'));if(1<b){f.append(jQuery('<li class="page-prev"><a href="javascript:;" data-pn="'+(b-1)+'" title="'+hsGetLang("list.prev.pagi")+'">&laquo;</a></li>'))}else{f.append(jQuery('<li class="page-prev disabled"><a href="javascript:;" title="'+hsGetLang("list.prev.page")+'">&laquo;</a></li>'))}for(g=c;g<h+1;g++){m.append(jQuery('<li class="'+(g!=b?"page-link":"page-curr active")+'"><a href="javascript:;" data-pn="'+g+'">'+g+"</a></li>"))}if(o>b){f.append(jQuery('<li class="page-next"><a href="javascript:;" data-pn="'+(b+1)+'" title="'+hsGetLang("list.next.pagi")+'">&raquo;</a></li>'))}else{f.append(jQuery('<li class="page-next disabled"><a href="javascript:;" title="'+hsGetLang("list.next.page")+'">&raquo;</a></li>'))}var n=null;var e=function(i){if(n){clearTimeout(n)}hsSetSeria(j._data,j.pageKey,i);j.load()};var l=function(i){if(n){clearTimeout(n)}n=setTimeout(function(){e(i)},500)};this.pageBox.find(".page-link a").on("click",function(i){e(jQuery(this).attr("data-pn"));i.preventDefault()});this.pageBox.find(".page-prev a").on("click",function(i){l(jQuery(this).attr("data-pn"));i.preventDefault()});this.pageBox.find(".page-next a").on("click",function(i){l(jQuery(this).attr("data-pn"));i.preventDefault()});this.pageBox.find(".page-prev a").on("dblclick",function(i){e(1);i.preventDefault()});this.pageBox.find(".page-next a").on("dblclick",function(i){e(o);i.preventDefault()});this.pageBox.find(".page-text a").on("click",function(i){j.gotoPage(b,a);i.preventDefault()})},gotoPage:function(a,c){var b=this;jQuery.hsMask({title:"请输入页码和条数",mode:"warn",html:'<form autocomplete="off" novalidate="novalidate"><span> 跳转到第 </span><input type="number" name="pn" value="'+a+'" class="form-control" style="display:inline-block;width:6em;" step="1"  min="1"  /><span> 页, </span><span> 平均每页 </span><input type="number" name="rn" value="'+c+'" class="form-control" style="display:inline-block;width:6em;" step="10" min="10" max="100"/><span> 条. </span><button type="submit" class="invisible"></button></form>'},{glass:"btn-primary",label:hsGetLang("ensure"),click:function(){var e=jQuery(this).closest(".alert-content").find("form");var f=parseInt(e.find("[name='rn']").val());var d=parseInt(e.find("[name='pn']").val());if(isNaN(d)||isNaN(f)||d<1||f<10||f>100){alert("输入错误, 页码需大于或等于1, 行数需10到100之间!");return false}jQuery(this).closest(".modal").find(":submit").click()}},{glass:"btn-default",label:hsGetLang("cancel")}).submit(function(d){d.preventDefault();d.stopPropagation();jQuery(this).closest(".modal").modal("hide");var f=$(this).find("[name=rn]").val();var e=$(this).find("[name=pn]").val();b._data=hsSerialArr(b._data);b._url=hsSetParam(b._url,b.rowsKey,f);hsSetSeria(b._data,b.pageKey,e);b.load()})},_ps_key:"state",_pc_key:"pages",_rc_key:"count",send:function(b,f,a,e){var d=this;var c=function(){var g=jQuery.extend({},hsSerialDat(a),hsSerialDat(e));d.ajax({url:a,data:e,type:"POST",dataType:"json",funcName:"send",cache:false,global:false,context:d,trigger:b,complete:function(h){this.sendBack(b,h,g)}})};if(!f){c()}else{this.warn(f,"warning",c,null)}},sendBack:function(b,d,c){d=hsResponse(d,1);if(d.ok){if(d.msg){this.note(d.msg,"success")}}else{if(d.msg){this.warn(d.msg,"warning")}else{this.warn(hsGetLang("error.unkwn"))}return}var a=jQuery.Event("sendBack");b.trigger(a,[d,c,this]);if(a.isDefaultPrevented()){return}this.load()},open:function(c,g,b,d){if(-1!=b.indexOf("{ID}")){var e,j,a=[];j=hsSerialArr(d);for(e=0;e<j.length;e++){a.push(encodeURIComponent(j[e].value))}b=b.replace("{ID}",a.join(","));d=undefined}var h=this;var f=jQuery.extend({},hsSerialDat(b),hsSerialDat(d));if(g){if(g instanceof String&&/^_/.test(g)){b=hsSetPms(b,d);window.open(b,g);return}g=c.hsFind(g);g.hsOpen(b,d,function(){h.openBack(c,jQuery(this),f)}).data("rel",c.closest(".loadbox").get(0))}else{jQuery.hsOpen(b,d,function(){h.openBack(c,jQuery(this),f)})}},openBack:function(a,c,d){var b=this;a.trigger("openBack",[c,d,this]);c.on("saveBack",function(f,h,e){var g=jQuery.Event("saveBack");g.relatedTarget=f.target;g.relatedHsInst=e;a.trigger(g,[h,d,b]);if(g.isDefaultPrevented()){return}b.load()})},ajax:function(){return jQuery.hsAjax.apply(window,arguments)},note:function(){return jQuery.hsNote.apply(window,arguments)},warn:function(){return jQuery.hsWarn.apply(window,arguments)},getAll:function(){var a=this.context.find(".checkone").filter(":checked");if(a.length==0){alert(hsGetLang("list.get.all"));return null}else{return a}},getOne:function(){var a=this.context.find(".checkone").filter(":checked");if(a.length!=1){alert(hsGetLang("list.get.one"));return null}else{return a}},getRow:function(b){var a=jQuery(b).closest("tr,.itembox").find(".checkone,[name=id],[data-fn=id],[data-ft=id]").first();if(a.is(".checkone")&&a.is(":checkbox,:radio")){a.not(":checked").prop("checked",true).change();a.closest("tr,.itembox").siblings("tr,.itembox").find(":checked.checkone").prop("checked",false).change()}return a},getIds:function(a){if(jQuery.inArray(this.listBox[0],jQuery(a).parents())!=-1){return this.getRow(a)}else{if(jQuery(a).hasClass("for-choose")){return this.getOne()}else{if(jQuery(a).hasClass("for-checks")){return this.getAll()}else{return jQuery()}}}},_fill__admin:function(c,a,b){this.listBox.find("thead th,thead td").eq(c.index()).find(".invisible").clone().removeClass("invisible").appendTo(c);jQuery(c).find("input:hidden").val(a);return false},_fill__check:function(c,a,b){jQuery('<input type="checkbox" class="input-checkbox checkone"/>').attr("name",b).val(a).appendTo(c);return false},_fill__radio:function(c,a,b){jQuery('<input type="radio" class="input-radio checkone"/>').attr("name",b).val(a).appendTo(c);return false},_fill__email:function(c,a,b){if(!a){return a}b="mailto:"+a;jQuery('<a target="_blank"></a>').attr("href",b).text(a).appendTo(c);return false},_fill__ulink:function(c,a,b){if(!a){return a}a=hsFixUri(a);jQuery('<a target="_blank"></a>').attr("href",a).text(a).appendTo(c);return false},_fill__nlink:function(c,a,b){b=b.replace(/(\[|\.)/,"-").replace(/(\]|\-$)/,"");jQuery('<a href="javascript:;"></a>').addClass("a-"+b).text(a).appendTo(c);return false},_fill__htime:function(e,a,d){if(a===undefined){return a}var c=new Date();var b=hsPrsDate(a,hsGetLang("datetime.format"));e.attr("title",this._fill__datetime(e,a,d));if(c.getFullYear()==b.getFullYear()&&c.getMonth()==b.getMonth()&&c.getDate()==b.getDate()){return hsGetLang("time.today",[hsFmtDate(a,hsGetLang("time.format"))])}else{return hsFmtDate(a,hsGetLang("date.format"))}},_fill__hdate:function(e,a,d){if(a===undefined){return a}var c=new Date();var b=hsPrsDate(a,hsGetLang("date.format"));e.attr("title",this._fill__datetime(e,a,d));if(c.getFullYear()==b.getFullYear()&&c.getMonth()==b.getMonth()&&c.getDate()==b.getDate()){return hsGetLang("date.today")}else{return hsFmtDate(a,hsGetLang("date.format"))}},_fill__datetime:function(c,a,b){if(a===undefined){return a}return hsFmtDate(a,hsGetLang("datetime.format"))},_fill__date:function(c,a,b){if(a===undefined){return a}return hsFmtDate(a,hsGetLang("date.format"))},_fill__time:function(c,a,b){if(a===undefined){return a}return hsFmtDate(a,hsGetLang("time.format"))},_fill__html:function(c,a,b){if(a===undefined){return a}jQuery(c).html(a);return false},_fill__text:function(c,a,b){if(a===undefined){return a}jQuery(c).text(a);return false},_fill__sort:function(c,a,d){if(c.find(".sort-ico").size()===0){var b=this;c.click(function(){var e=null;if(!!c.hasClass("sort-asc")){e="-"+d}else{if(!c.hasClass("sort-esc")){e=d}}hsSetSeria(b._data,b.sortKey,e);b.load()});c.append('<span class="sort-ico"></span>')}c.removeClass("sort-asc sort-esc");if(a===d){c.addClass("sort-asc")}else{if(a==="-"+d){c.addClass("sort-esc")}}}};function hsListFillMore(a){HsList.prototype.fillPage.call(this,a);this.pageBox.find(".page-text").remove();this.pageBox.find(".pagination").removeClass("pull-left")}function hsListFillLess(a){HsList.prototype.fillPage.call(this,a);this.pageBox.find(".pagination").removeClass("pull-left").removeClass("pagination").addClass("pager");this.pageBox.find(".page-text,.page-link,.page-curr").remove();this.pageBox.find(".page-prev").text(hsGetLang("list.prev.page"));this.pageBox.find(".page-next").text(hsGetLang("list.next.page"))}function hsListFillNext(f){if(f[this._ps_key]=="0"){if(f[this._pc_key]=="0"||f[this._rc_key]=="0"){this.warn(this._empty_err||hsGetLang("list.empty"),"warning");return}else{this.warn(this._above_err||hsGetLang("list.above"),"warning");return}}var e=f[this.rowsKey]?parseInt(f[this.rowsKey]):this.rowsNum;var g=f[this.pageKey]?parseInt(f[this.pageKey]):1;var b=f[this._pc_key]?parseInt(f[this._pc_key]):(f[this._rc_key]==0?g-1:(f[this._rc_key]==e?g+1:g));var a=this.pageBox.find("[data-pn]");if(a.size()===0){this.pageBox.append(jQuery('<ul class="pager"></ul>').append(jQuery('<li class="page-prev"><a href="javascript:;" data-pn="">'+hsGetLang("list.prev.page")+"</a></li>")).append(jQuery('<li class="page-curr active"><a href="javascript:;"></a></li>')).append(jQuery('<li class="page-next"><a href="javascript:;" data-pn="">'+hsGetLang("list.next.page")+"</a></li>")));a=this.pageBox.find("[data-pn]")}var c=this.pageBox.find(".page-curr a");if(c.size()===0){c=this.pageBox.find(".page-curr")}if(f[this._ps_key]=="2"){c.text(g)}else{c.text(g+"/"+b)}if(g>1){c=a.closest(".page-prev").removeClass("disabled");c.filter("[data-pn]").attr("data-pn",g-1);c.find("[data-pn]").attr("data-pn",g-1)}else{c=a.closest(".page-prev").addClass("disabled");c.filter("[data-pn]").attr("data-pn",1);c.find("[data-pn]").attr("data-pn",1)}if(g<b){c=a.closest(".page-next").removeClass("disabled");c.filter("[data-pn]").attr("data-pn",g+1);c.find("[data-pn]").attr("data-pn",g+1)}else{c=a.closest(".page-next").addClass("disabled");c.filter("[data-pn]").attr("data-pn",b);c.find("[data-pn]").attr("data-pn",b)}if(!this.pageBox.data("inited")){this.pageBox.data("inited",1);var d=this;this.pageBox.on("click","[data-pn]",function(h){h.preventDefault();var i=jQuery(this);var j=i.data("pn");var k=d.pageKey;if(i.prop("disabled")){return}hsSetSeria(d._data,k,j);d.load()})}}function hsListFillItem(list){var that=this;var tt,tr,td,n,t,v,f;if(!this.itemBox){this.itemBox=this.context.find(".itembox:hidden:first")}tt=this.itemBox;if(!this._keep_prev||!(this._keep_void&&list.length==0)){this.listBox.children().not(tt).remove()}this._list=list;for(var i=0;i<list.length;i++){this._info=list[i];tr=tt.clone();tr.find("[data-fn],[data-ft],[data-fl]").each(function(){td=jQuery(this);n=td.data("fn");t=td.data("ft");f=td.data("fl");if(n!==undefined){v=hsGetValue(list[i],n);if(v===undefined){v=list[i][n]}}else{v=undefined}if(f&&typeof f!="function"){try{f=eval("(null||function(list,v,n){return "+f+";})")}catch(e){throw new Error("Parse list data-fl error: "+e)}td.data("fl",f)}if(f){v=f.call(td[0],that,v,n)}if(n&&that["_fill_"+n]!==undefined){v=that["_fill_"+n].call(that,td,v,n)}else{if(t&&that["_fill_"+t]!==undefined){v=that["_fill_"+t].call(that,td,v,n)}}if(!v&&v!==0&&v!==""){return}td.text(v)});tr.css("display","");this.listBox.append(tr)}delete this._list;if(typeof(this._info)!=="undefined"){delete this._info}}jQuery.fn.hsList=function(a){return this.hsBind(HsList,a)};(function(a){a(document).on("mouseover",".table-responsive-revised th,.table-responsive-revised td",function(b){if(a(this).children().not("a,b,i,sub,sup,span").size()){return}if(this.offsetWidth<this.scrollWidth){if(a(this).attr("title")&&a(this).data("title")){return}var c=a(this).text();a(this).attr("title",c)}else{a(this).attr("title","")}}).on("mouseout",".table-responsive-revised th,.table-responsive-revised td",function(b){if(a(this).children().not("a,b,i,sub,sup,span").size()){return}a(this).attr("title","")}).on("click",".listbox tbody td",function(b){if(a(b.target).is("a,input,textarea,button,select,option")||a(this).is(".dont-check,._admin,._amenu")){return}var d=a(this).closest("tr");var c=d.find(".checkone");if(c.is(":disabled")){return}c.prop("checked",!c.prop("checked")).change();if(this!==c.closest("td")[0]){d.closest("tbody").find(".checkone:checked").not(":disabled").not(c).prop("checked",false).change()}}).on("change",".HsList .checkone",function(){var e=a(this).closest(".HsList");var c=a(this).prop("checked");var b=e.find(".checkone").not(":disabled").length;var d=e.find(".checkone").not(":disabled").filter(":checked").length;var f=b&&b==d?true:(d&&d!=b?null:false);a(this).closest("tr").toggleClass("active",c);e.find(".checkall").prop("choosed",f);e.find(".for-choose").prop("disabled",1!=d);e.find(".for-checks").prop("disabled",0==d)}).on("change",".HsList .checkall",function(){var c=a(this).closest(".HsList");var b=a(this).prop("checked");var d=c.find(".checkone").not(":disabled");a(d).prop("checked",b).trigger("change");a(this).prop("choosed",b)}).on("loadOver",".HsList .listbox",function(){var b=a(this).closest(".HsList");b.find(".for-choose, .for-checks").prop("disabled",true);b.find(".checkall").prop("checked",false).prop("choosed",false)})})(jQuery);