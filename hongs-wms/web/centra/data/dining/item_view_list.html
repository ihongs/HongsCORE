<div id="centra-data-dining-item-view-list">
    <div class="listbox table-responsive" style="margin-bottom: 0; margin-top: 3px;">
        <table class="table table-hover table-striped">
            <thead>
                <tr>
                    <th data-fn="name">名称</th>
                    <th data-fn="price" style="width:5em;" class="text-right">单价</th>
                    <th data-fn="count" style="width:5em;" class="text-right">数量</th>
                </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr>
                    <th>总价/总数:</th>
                    <th class="total text-right"></th>
                    <th class="count text-right"></th>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
<script type="text/javascript">
    (function($) {
        var context = $("#centra-data-dining-item-view-list").removeAttr("id");
        var unitTn  = H$("#unit", context) || "food";
        var unitFn  = unitTn !== "food" ? unitTn + "_id" : "unit_id";
        var unitId  = H$(  "#" + unitFn , context  );
        
        var listobj = context.hsList({
            _url: "centra/data/dining/"+unitTn+"/item/search.act?md=6&rn=0&"+unitFn+"="+unitId
        });
        listobj.fillPage = function() {};
        listobj.fillList = function(lst) {
            this._total = 0;
            this._count = 0;
            HsList.prototype.fillList.call(this,lst);
            context.find(".total").text(this._total);
            context.find(".count").text(this._count);
        };
        listobj._fill_name  = function() {
            return this._info.name
                || this._info.food.name ;
        };
        listobj._fill_price = function() {
            return this._info.price
                || this._info.food.price;
        };
        listobj._fill_count = function() {
            var count = this._info.count || 1;
            var price = this._info.food.price;
            this._count += parseFloat(count);
            this._total += parseFloat(count)
                        *  parseFloat(price);
            return this._info.count;
        };
        listobj.load();
    })(jQuery);
</script>
